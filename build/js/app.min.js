(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports={
  "hero": {
    "stats": {
      "off": 1,
      "def": 1,
      "spd": 1,
      "guts": 1,
      "vit": 1,
      "iq": 20,
      "luck": 1
    },
    "equip": {
      "weapon": null,
      "arm": null,
      "body": null,
      "other": null
    },
    "sprite": "hero",
    "level": 1,
  }
}

},{}],2:[function(require,module,exports){
module.exports={
  "mushroom": {
    "stats": {
      "hp": 10,
      "def": 5,
      "off": 3,
      "guts": 10,
      "luck": 30,
      "miss": 20
    },
    "xp": 6,
    "money": 6,
    "level": 2,
    "music": "silly",
    "strategy": "random",
    "actions": ["bash", "heal", "bash", "mushroom"],
    "drop": "fungi",
    "dropfreq": 2,
    "status": "normal"
  }
}

},{}],3:[function(require,module,exports){
module.exports={
  "someevent": {
    "pages": [{
      "trigger": "action",
      "type": "fixed",
      "sprite": "somespriteid",
      "conditions": {},
      "commands": []
    }]
  }
}

},{}],4:[function(require,module,exports){
module.exports={
  "crackedbat": {
    "type": "weapon",
    "cost": 18,
    "stats": {
      "off": 4
    }
  },
  "ramen": {
    "type": "food",
    "cost": 12,
    "stats": {
      "hp": 30
    }
  }
}

},{}],5:[function(require,module,exports){
module.exports={
    "CHARACTER_NAME_hero": "Izumi",

    "ITEM_NAME_ramen": "Ramen",

    "ENEMY_NAME_mushroom": "Mushroom"
}

},{}],6:[function(require,module,exports){
module.exports={
  "map_house": {"type": "map", "path": "maps/house.json",
    "tileset": ["tiles_house"],
    "bgm": "bgm_boymeetsgirl"
  },

  "tiles_house": {"type": "image", "path": "images/house_tileset.png"},

  "image_dialog": {"type": "image", "path": "images/dialog.png"},
  "battlebg_1": {"type": "image", "path": "images/battlebg/1.png"},

  "font_basic": {"type": "bitmapfont", "path": "fonts/basic.png", "meta": "fonts/basic.xml"},
  "font_mrsaturn": {"type": "bitmapfont", "path": "fonts/mrsaturn.png", "meta": "fonts/mrsaturn.xml"},

  "sfx_door_open": {"type": "audio", "path": ["audio/effect_door_open.wav"]},
  "bgm_boymeetsgirl": {"type": "audio", "path": ["audio/background_boymeetsgirl.mp3"]},

  "default": {"type": "resources", "resources": ["image_dialog", "font_basic", "sfx_door_open", "battlebg_1"]}
}

},{}],7:[function(require,module,exports){
module.exports={
    "worldmenu": {
        "type": "menu",
        "x": 8,
        "y": 8,
        "width": 64,
        "height": 64,
        "rows": 3
    },
    "worldgoodsmenu": {
        "type": "menu",
        "x": 32,
        "y": 32,
        "width": 152,
        "height": 64,
        "rows": 3
    },
    "matte": {
        "type": "matte"
    },
    "new": {
        "type": "frame",
        "x": 8,
        "y": 8,
        "width": 64,
        "height": 64
    },
    "battlebg": {
        "type": "battlebg"
    }
}

},{}],8:[function(require,module,exports){
/* global Phaser */

var properties = require('./properties');
var states = {
    boot: require('./states/boot.js'),
    preloader: require('./states/preloader.js'),
    game: require('./states/game.js')
};
var game = new Phaser.Game(properties.size.x, properties.size.y, Phaser.AUTO, 'game', null, false, false);

var Config = require('./utils/Config');
Config.load({
    resources: require('../config/resources.json'),
    characters: require('../config/characters.json'),
    enemies: require('../config/enemies.json'),
    events: require('../config/events.json'),
    items: require('../config/items.json'),
    lang: require('../config/lang.json'),
    ui: require('../config/ui.json')    
});

// Automatically register each state.
Object.keys(states).forEach(function(key) {
    var state = states[key];
    game.state.add(key, state);
});

game.state.start('boot');

},{"../config/characters.json":1,"../config/enemies.json":2,"../config/events.json":3,"../config/items.json":4,"../config/lang.json":5,"../config/resources.json":6,"../config/ui.json":7,"./properties":19,"./states/boot.js":20,"./states/game.js":21,"./states/preloader.js":22,"./utils/Config":36}],9:[function(require,module,exports){
/* global Phaser */

function Character(game, x, y, skin, physics) {
    var offest = skin * 8;
    Phaser.Sprite.call(this, game, x, y, 'actors', offest + 4);
    this.animations.add('up', [offest + 0, offest + 1], 5, true);
    this.animations.add('right', [offest + 2, offest + 3], 10, true);
    this.animations.add('down', [offest + 4, offest + 5], 5, true);
    this.animations.add('left', [offest + 6, offest + 7], 10, true);

    this.anchor.setTo(0.5, 1);

    if (physics) {
        game.physics.arcade.enable(this);
        this.body.setSize(14, 7, 5, 27);
        game.slopes.enable(this);
    }
}

Character.prototype = Object.create(Phaser.Sprite.prototype);
Character.prototype.constructor = Character;

module.exports = Character;

},{}],10:[function(require,module,exports){
var Character = require('./Character');

function Enemy(game, type, x, y) {
    Character.call(this, game, x, y, 7, true);
    this.timer = 0;
    this.accel = 80;
    this.visLife = 60;

    this.velX = 0;
    this.velY = 0;
}

Enemy.prototype = Object.create(Character.prototype);
Enemy.prototype.constructor = Enemy;

Enemy.prototype.update = function () {
    if (!this.inCamera) {
        this.visLife--;
        if (this.visLife < 0) {
            this.kill();
            return;
        }
    } else {
        this.visLife = 60;
    }

    if (this.game.state.getCurrentState().playerDisabled) {
        this.body.velocity.x = 0;
        this.body.velocity.y = 0;
        this.animations.stop();
        return;
    }

    this.timer--;
    if (this.timer <= 0) {
        this.velX = Math.floor(Math.random() * 2 - 1) * this.accel;
        this.velY = Math.floor(Math.random() * 2 - 1) * this.accel;
        this.timer = 60;
    }

    this.body.velocity.x = this.velX;
    this.body.velocity.y = this.velY;

    var direction = null;

    if ((this.body.velocity.x < this.body.velocity.y) && (this.body.velocity.x < 0))
    {
        direction = 'left';
    }
    else if ((this.body.velocity.x > this.body.velocity.y) && (this.body.velocity.x > 0))
    {
        direction = 'right';
    }

    if ((this.body.velocity.y < this.body.velocity.x) && (this.body.velocity.y < 0))
    {
        direction = 'up';
    }
    else if ((this.body.velocity.y > this.body.velocity.x) && (this.body.velocity.y > 0))
    {
        direction = 'down';
    }

    if (direction) {
        this.play(direction);
    } else {
        this.animations.stop();
    }
};

Enemy.prototype.onTouch = function() {
    this.game.state.getCurrentState().switchSubState('battle');
    this.kill();
};

module.exports = Enemy;

},{"./Character":9}],11:[function(require,module,exports){
var Character = require('./Character');

function Follower(game, skin, followCharacter) {
    Character.call(this, game, followCharacter.x, followCharacter.y, skin, false);
    this.initQueue(followCharacter, 16);
}

Follower.prototype = Object.create(Character.prototype);
Follower.prototype.constructor = Follower;

Follower.prototype.initQueue = function(followCharacter, followMax) {
    this.followCharacter = followCharacter;
    this.followQueue = [];
    this.leaderCursor = 0;
    this.followerCursor = 1;
    this.followMax = followMax;
    for (var f = 0; f < followMax; f++) {
        this.followQueue[f] = {animation: 'down', x: followCharacter.x, y: followCharacter.y};
    }
};

Follower.prototype.updateQueue = function() {
    this.leaderCursor = (this.leaderCursor + 1) % this.followMax;
    this.followerCursor = (this.followerCursor + 1) % this.followMax;
    this.followQueue[this.leaderCursor].animation = this.followCharacter.animations.currentAnim.name;
    this.followQueue[this.leaderCursor].x = this.followCharacter.x;
    this.followQueue[this.leaderCursor].y = this.followCharacter.y;
    var followerMeta = this.followQueue[this.followerCursor];
    this.x = followerMeta.x;
    this.y = followerMeta.y;
    this.play(followerMeta.animation);
};

Follower.prototype.update = function () {
    if (this.game.state.getCurrentState().playerDisabled) {
        this.animations.stop();
        return;
    }

    // Handle Following
    if (this.followCharacter.animations.currentAnim.isPlaying) {
        this.updateQueue();
    } else {
        this.animations.stop();
    }
}

module.exports = Follower;

},{"./Character":9}],12:[function(require,module,exports){
var Character = require('./Character');

function Player(game, map, x, y, skin) {
    Character.call(this, game, x, y, skin, true);
    this.map = map;

    // this.body.drag.x = 640;
    // this.body.drag.y = 640;
    // this.body.maxVelocity.x = 80;
    // this.body.maxVelocity.y = 80;
    this.accel = 80;
}

Player.prototype = Object.create(Character.prototype);
Player.prototype.constructor = Player;

Player.prototype.update = function () {
    this.body.velocity.x = 0;
    this.body.velocity.y = 0;
    if (this.game.state.getCurrentState().playerDisabled) {
        this.animations.stop();
        return;
    }

    var direction = null;
    var cursors = this.game.state.getCurrentState().cursors;

    if (cursors.left.isDown)
    {
        this.body.velocity.x = -this.accel;
        direction = 'left';
    }
    else if (cursors.right.isDown)
    {
        this.body.velocity.x = this.accel;
        direction = 'right';
    }

    if (cursors.up.isDown)
    {
        this.body.velocity.y = -this.accel;
        direction = 'up';
    }
    else if (cursors.down.isDown)
    {
        this.body.velocity.y = this.accel;
        direction = 'down';
    }

    if (direction) {
        this.play(direction);
    } else {
        this.animations.stop();
    }
};

module.exports = Player;

},{"./Character":9}],13:[function(require,module,exports){
/* global Phaser */

var Follower = require('./Follower');
var Player = require('./Player');

function PlayerGroup(game, currentMap, x, y) {
    Phaser.Group.call(this, game);
    this.player = new Player(game, currentMap, x, y, 0);
    var follower = new Follower(game, 1, this.player);
    var follower2 = new Follower(game, 2, follower);
    this.add(this.player);
    this.add(follower);
    this.add(follower2);
}

PlayerGroup.prototype = Object.create(Phaser.Group.prototype);
PlayerGroup.prototype.constructor = PlayerGroup;

PlayerGroup.prototype.reset = function (x, y) {
    this.player.reset(x, y);
};

PlayerGroup.prototype.getLeader = function () {
    return this.player;
};

module.exports = PlayerGroup;

},{"./Follower":11,"./Player":12}],14:[function(require,module,exports){
var Event = require('./Event');

function DialogEvent(game, settings) {
    Event.call(this, game, settings);
}

DialogEvent.prototype = Object.create(Event.prototype);
DialogEvent.prototype.constructor = DialogEvent;

DialogEvent.prototype.onTouch = function() {
    var properties = this.settings.properties;
    this.game.showDialog(properties.text);
};

module.exports = DialogEvent;

},{"./Event":15}],15:[function(require,module,exports){
/* global Phaser */

function Event(game, settings) {
    this.game = game;
    this.settings = settings;

    Phaser.Sprite.call(this, game, settings.x || 0, settings.y || 0);
    this.renderable = false;
    this.width = settings.width || 16;
    this.height = settings.height || 16;
    game.physics.arcade.enable(this);
    this.body.immovable = true;
}

Event.prototype = Object.create(Phaser.Sprite.prototype);
Event.prototype.constructor = Event;

Event.prototype.onTouch = function() {};

module.exports = Event;

},{}],16:[function(require,module,exports){
var Event = require('./Event');

function Spawn(game, settings) {
    Event.call(this, game, settings);
    this.flagIsVisible = false;
}

Spawn.prototype = Object.create(Event.prototype);
Spawn.prototype.constructor = Spawn;

Spawn.prototype.update = function() {
    if (this.inCamera && !this.flagIsVisible) {
        this.flagIsVisible = true;
        this.onVisible();
    } else if (!this.inCamera && this.flagIsVisible) {
        this.flagIsVisible = false;
    }
}

Spawn.prototype.onVisible = function() {
    this.game.spawnEnemy(this.settings.type, this.body.x + this.body.width / 2, this.body.y + this.body.height / 2);
};

module.exports = Spawn;

},{"./Event":15}],17:[function(require,module,exports){
var Event = require('./Event');

function TransportEvent(game, settings) {
    Event.call(this, game, settings);
}

TransportEvent.prototype = Object.create(Event.prototype);
TransportEvent.prototype.constructor = TransportEvent;

TransportEvent.prototype.onTouch = function() {
    var properties = this.settings.properties;
    this.game.transport(properties.map, properties.location);
};

module.exports = TransportEvent;

},{"./Event":15}],18:[function(require,module,exports){
var EventTypes = {
    transport: require('../events/TransportEvent'),
    dialog: require('../events/DialogEvent')
};
var Spawn = require('../events/Spawn');

function Map(game, config) {
    this.game = game;
    this.id = config.id;
    this.map = game.add.tilemap(config.id);
    config.tileset.forEach(function(tileset) {
        this.map.addTilesetImage(tileset, tileset);
    }, this);

    game.world.setBounds(0, 0, this.map.widthInPixels, this.map.heightInPixels);

    this.backgroundLayer = this.map.createLayer('background');
    this.foregroundLayer = this.map.createLayer('foreground');
    // floatingLayer = map.createLayer('floating');

    this.locations = this.setupLocations(this.map);
    this.events = this.setupEvents(this.game, this.map);
    this.spawns = this.setupSpawns(this.game, this.map);

    var slopeLookup = {
        291: null,
        158: 'HALF_TOP_RIGHT',
        159: 'HALF_TOP_LEFT',
        97: null,
        80: 'HALF_TOP_RIGHT',
        81: 'HALF_TOP_LEFT',
        82: 'HALF_TOP_LEFT'
    }
    var slopeMap = [];
    for (var i = 0; i <= 291; i++) {
        slopeMap.push(slopeLookup[i] !== null ? slopeLookup[i] || 'FULL' : undefined);
    }
    this.game.game.slopes.convertTilemapLayer(this.backgroundLayer, slopeMap);
    // this.map.setCollisionBetween(0, 291, true, 'background');
}

Map.prototype.getEvents = function () {
    return this.events;
}

Map.prototype.setupSpawns = function (game, map) {
    var spawns = [];
    map.objects['Spawns'].forEach(function(element){
        spawns.push(new Spawn(game, element));
    });
    return spawns;
}

Map.prototype.setupEvents = function (game, map) {
    var events = [];
    map.objects['Events'].forEach(function(element){
        events.push(new (EventTypes[element.type])(game, element));
    });
    return events;
}

Map.prototype.setupLocations = function (map) {
    var locations = {};
    map.objects['Locations'].forEach(function(element){
        locations[element.name] = {
            x: element.x + element.width / 2,
            y: element.y + element.height / 2
        };
    });
    return locations;
}

Map.prototype.getLocation = function(id) {
    return this.locations[id];
}

module.exports = Map;

},{"../events/DialogEvent":14,"../events/Spawn":16,"../events/TransportEvent":17}],19:[function(require,module,exports){
var npmProperties = require('../package.json');

module.exports = {
    title: 'Earthbound.js',
    description: npmProperties.description,
    port: 3017,
    liveReloadPort: 3018,
    mute: false,
    showStats: true,
    size: {
        x: 256,
        y: 224
    },
    analyticsId: 'UA-5075951-7'
};

},{"../package.json":39}],20:[function(require,module,exports){
/* global Stats */

var properties = require('../properties');
var boot = {};

boot.create = function () {
    if (properties.showStats) {
        addStats(this.game);
    }

    this.game.sound.mute = properties.mute;

    this.game.state.start('preloader');
};

function addStats(game) {
    var stats = new Stats();

    stats.setMode(0);

    stats.domElement.style.position = 'absolute';
    stats.domElement.style.right = '0px';
    stats.domElement.style.top = '0px';

    document.body.appendChild(stats.domElement);

    // In order to correctly monitor FPS, we have to make calls to the stats package before and after phaser's update.
    var oldUpdate = game.update;
    game.update = function() {
        stats.begin();
        oldUpdate.apply(game, arguments);
        stats.end();
    };
}

module.exports = boot;

},{"../properties":19}],21:[function(require,module,exports){
/* global Phaser */

var Config = require('../utils/Config')
var Loader = require('../utils/Loader');
var SubState = require('../utils/SubState');
var PlayerGroup = require('../entities/PlayerGroup');
var Enemy = require('../entities/Enemy');
var Map = require('../map/Map');
var substates = {
    world: require('../substates/World'),
    transition: require('../substates/Transition'),
    dialog: require('../substates/Dialog'),
    battle: require('../substates/Battle'),
    worldmenu: require('../substates/WorldMenu'),
    worldgoodsmenu: require('../substates/WorldGoodsMenu')
};
var DialogComponent = require('../ui/DialogComponent');
var uiTypes = require('../ui');

var game = {};

game.substate = new SubState(game, substates);

game.init = function(mapid, startLocation) {
    this.mapId = mapid;
    this.startLocationId = startLocation;
}

game.preload = function () {
    Loader.loadResource(game.game, 'default');
    Loader.loadResource(game.game, this.mapId);

    game.load.spritesheet('actors', 'images/actors.png', 24, 32);
}

game.create = function () {
    this.mapConfig = Config.getResource(this.mapId);

    this.physics.startSystem(Phaser.Physics.ARCADE);
    this.game.plugins.add(Phaser.Plugin.ArcadeSlopes);
    game.physics.arcade.gravity.y = 0;

    if (this.mapConfig.bgm) {
        this.backgroundMusic = game.add.audio(this.mapConfig.bgm);
        this.backgroundMusic.play('', 0, 1, true);
    }
    this.soundEffects = {
        sfx_door_open: game.add.audio('sfx_door_open')
    };
    this.currentMap = new Map(game, this.mapConfig);
    this.enemies = game.add.group();

    this.spawns = game.add.group();
    this.currentMap.spawns.forEach(function (spawn) {
        this.spawns.add(spawn);
    }, this);

    var playerStart = this.currentMap.getLocation(this.startLocationId);
    this.player = new PlayerGroup(game.game, this.currentMap, playerStart.x, playerStart.y);
    this.chatDialog = new DialogComponent(game.game);
    this.setupUI();
    this.switchSubState('world');

    this.cursors = game.input.keyboard.createCursorKeys();
    this.actionKey = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    this.cancelKey = game.input.keyboard.addKey(Phaser.Keyboard.X);
    this.game.input.keyboard.addKeyCapture([ Phaser.Keyboard.SPACEBAR, Phaser.Keyboard.X ]);

    this.fadeIn();
};

game.setupUI = function() {
    var uiConfig = Config.getConfig('ui');
    var ui = {};
    Object.keys(uiConfig).forEach(function (key) {
        var config = uiConfig[key];
        ui[key] = new (uiTypes[config.type])(game.game, config);
    });
    this.ui = ui;
}

/* Simple Debug
game.render = function () {
    game.game.debug.body(this.player);
}
*/

game.update = function () {
    this.substate.update();
}

game.switchSubState = function (id) {
    this.substate.switch(id);
};

/* ------- Actions ---------- */

game.fadeIn = function (callback) {
    this.ui.matte.transition(0x000000, 0, 500, callback);
};

game.fadeOut = function (callback) {
    this.ui.matte.transition(0x000000, 1, 500, callback);
};

game.encounterIn = function (callback) {
    this.ui.matte.transition(0xFF0000, 0.5, 500, callback);
};

game.encounterOut = function (callback) {
    this.ui.matte.transition(0xFF0000, 0, 10, callback);
};

game.hideWorld = function () {
    this.player.visible = false;
    this.enemies.visible = false;
    this.currentMap.backgroundLayer.visible = false;
    this.currentMap.foregroundLayer.visible = false;
    this.ui.matte.matte.visible = false;
    // this.world.visible = false;
}

game.showWorld = function () {
    this.player.visible = true;
    this.enemies.visible = true;
    this.currentMap.backgroundLayer.visible = true;
    this.currentMap.foregroundLayer.visible = true;
    this.ui.matte.matte.visible = true;
    // this.world.visible = true;
}

game.hideBattle = function () {
    this.ui.battlebg.hide();
}

game.showBattle = function () {
    this.ui.battlebg.show();
}

game.soundEffectPlay = function (id) {
    this.soundEffects[id].play();
};

game.transport = function(mapId, locationId) {
    var self = this;
    this.switchSubState('transition');
    this.soundEffectPlay('sfx_door_open');
    this.fadeOut(function() {
        if (self.mapId === mapId) {
            var locationPos = self.currentMap.getLocation(locationId);
            self.player.reset(locationPos.x, locationPos.y);
            self.fadeIn(function() {
                self.switchSubState('world');
            });
        } else {
            self.backgroundMusic.stop();
            self.state.start('game', true, false, mapId, locationId);
        }
    });
};

game.showDialog = function (displayText) {
    this.chatDialog.setText(displayText);
    this.switchSubState('dialog');
}

game.mapTint = function (tint) {
    this.currentMap.foregroundLayer.tint = tint;
    this.currentMap.backgroundLayer.tint = tint;
}

game.spawnEnemy = function (type, x, y) {
    this.enemies.add(new Enemy(this.game, type, x, y));
}

// Use //foregroundLayer.tint = 0x222299; to simulate nighttime


module.exports = game;

},{"../entities/Enemy":10,"../entities/PlayerGroup":13,"../map/Map":18,"../substates/Battle":23,"../substates/Dialog":24,"../substates/Transition":26,"../substates/World":27,"../substates/WorldGoodsMenu":28,"../substates/WorldMenu":29,"../ui":35,"../ui/DialogComponent":31,"../utils/Config":36,"../utils/Loader":37,"../utils/SubState":38}],22:[function(require,module,exports){
var preloader = {};

preloader.preload = function () {
    // this.game.load.image('logo', 'images/phaser.png');
};

preloader.create = function () {
    this.game.state.start('game', true, false, 'map_house', 'start');
};

module.exports = preloader;

},{}],23:[function(require,module,exports){

var BattleSubState = function(state) {
    this.parent = state;
}

BattleSubState.prototype.transitionIn = function(callback) {
    var state = this.parent;
    state.encounterIn(function () {
        state.hideWorld();
        state.showBattle();
        callback();
    });
}

BattleSubState.prototype.update = function() {
    var state = this.parent;
    if (state.actionKey.isDown) {
        state.switchSubState('world');
    }
};

BattleSubState.prototype.transitionOut = function(callback) {
    var state = this.parent;
    state.showWorld();
    state.hideBattle();
    state.encounterOut(callback);
}

module.exports = BattleSubState;

},{}],24:[function(require,module,exports){

var DialogSubState = function(state) {
    this.parent = state;
}

DialogSubState.prototype.enter = function() {
    this.parent.chatDialog.show();
};

DialogSubState.prototype.update = function() {
    var state = this.parent;

    if (state.actionKey.isDown) {
        state.switchSubState('world');
    }
};

DialogSubState.prototype.exit = function() {
    this.parent.chatDialog.hide();
};

module.exports = DialogSubState;

},{}],25:[function(require,module,exports){
var MenuSubState = function(state) {
    this.parent = state;
}

MenuSubState.prototype.enter = function() {
    var state = this.parent;
    this.menu = state.ui[this.menuId];
    this.menu.setOptions(this.getOptions());
    this.menu.show();
    this.setCoolOff();
};

MenuSubState.prototype.update = function() {
    var state = this.parent;

    if (this.coolOff <= 0) {
        if (state.cancelKey.isDown) {
            this.onCancel && this.onCancel();
        } else if (state.actionKey.isDown) {
            this.onSelect && this.onSelect(this.menu.getSelectedId());
        } else if (state.cursors.up.isDown) {
            this.menu.selectionUp()
            this.setCoolOff();
        } else if (state.cursors.down.isDown) {
            this.menu.selectionDown()
            this.setCoolOff();
        }
    } else {
        this.coolOff--;
    }
};

MenuSubState.prototype.setCoolOff = function() {
    this.coolOff = 10;
};

module.exports = MenuSubState;

},{}],26:[function(require,module,exports){

var TransitionSubState = function(state) {
    this.parent = state;
};

TransitionSubState.prototype.enter = function() {

}

module.exports = TransitionSubState;

},{}],27:[function(require,module,exports){
/* global Phaser */

var WorldSubState = function(parent) {
    this.parent = parent;
}

WorldSubState.prototype.enter = function() {
    var state = this.parent;
    state.playerDisabled = false;
    state.game.camera.follow(state.player.getLeader(), Phaser.Camera.FOLLOW_TOPDOWN);
    this.actionCoolOff = 20;
};

WorldSubState.prototype.update = function() {
    var state = this.parent;

    if (this.actionCoolOff > 0) {
        this.actionCoolOff--;
    } else {
        if (state.cancelKey.isDown) {
            state.switchSubState('worldmenu');
        }
    }

    state.enemies.sort('y', Phaser.Group.SORT_ASCENDING);
    state.player.sort('y', Phaser.Group.SORT_ASCENDING);

    state.physics.arcade.collide(state.enemies, state.currentMap.backgroundLayer);

    if (!state.playerDisabled) {
        var events = state.currentMap.getEvents();

        state.physics.arcade.collide(state.player, state.currentMap.backgroundLayer);
        state.physics.arcade.collide(state.player, state.enemies, function(player, enemy) {
            enemy.onTouch();
        });
        state.physics.arcade.collide(state.player.getLeader(), events, function(player, event) {
            event.onTouch();
        });
    }
};

WorldSubState.prototype.exit = function() {
    this.parent.playerDisabled = true;
}

module.exports = WorldSubState;

},{}],28:[function(require,module,exports){
var MenuSubState = require('./Menu');

var WorldGoodsMenuSubState = function(state) {
    MenuSubState.call(this, state);
}

WorldGoodsMenuSubState.prototype = Object.create(MenuSubState.prototype);
WorldGoodsMenuSubState.prototype.constructor = WorldGoodsMenuSubState;

WorldGoodsMenuSubState.prototype.menuId = 'worldgoodsmenu';

WorldGoodsMenuSubState.prototype.getOptions = function() {
    return [
        {id: 'sneaker', text: 'Old Sneaker'},
        {id: 'stungun', text: 'Stun Gun'},
        {id: 'sock', text: 'Sock'}
    ];
};

WorldGoodsMenuSubState.prototype.onCancel = function() {
    this.menu.hide();
    this.parent.switchSubState('worldmenu');
};

WorldGoodsMenuSubState.prototype.onSelect = function(id) {

};

module.exports = WorldGoodsMenuSubState;

},{"./Menu":25}],29:[function(require,module,exports){
var MenuSubState = require('./Menu');

var WorldMenuSubState = function(state) {
    MenuSubState.call(this, state);
}

WorldMenuSubState.prototype = Object.create(MenuSubState.prototype);
WorldMenuSubState.prototype.constructor = WorldMenuSubState;

WorldMenuSubState.prototype.menuId = 'worldmenu';

WorldMenuSubState.prototype.getOptions = function() {
    return [
        {id: 'goods', text: 'Goods'},
        {id: 'equip', text: 'Equip'},
        {id: 'status', text: 'Status'}
    ];
};

WorldMenuSubState.prototype.onCancel = function() {
    this.menu.hide();
    this.parent.switchSubState('world');
};

WorldMenuSubState.prototype.onSelect = function(id) {
    switch (id) {
        case 'goods': this.parent.switchSubState('worldgoodsmenu'); break;
    }
};

module.exports = WorldMenuSubState;

},{"./Menu":25}],30:[function(require,module,exports){
/* global Phaser */

function BattleBackgroundLine(game, y, width, height, skin) {
    Phaser.Sprite.call(this, game, 0, y, skin);
    this.lineWidth = width;
    this.lineHeight = height;
    this.t = 0;
}

BattleBackgroundLine.prototype = Object.create(Phaser.Sprite.prototype);
BattleBackgroundLine.prototype.constructor = BattleBackgroundLine;

BattleBackgroundLine.prototype.update = function () {
    var t = this.t++;
    var y = this.y;
    var width = this.lineWidth;
    var height = this.lineHeight;

    var A = 30;
    var F = 0.03;
    var S = 0.04;

    var offset = A * Math.sin(F * y + S * t);
    this.crop(new Phaser.Rectangle(Math.floor((offset + width) % width), y % 64, width, height));
    this.updateCrop();
};

function BattleBackground(game, config) {
    var width = game.width;
    var height = game.height;
    var background = game.add.group();
    var size = 2;

    background.fixedToCamera = true;
    for (var y = 0; y < height; y += 2) {
        background.add(new BattleBackgroundLine(game, y, width, size, 'battlebg_1'));
    }

    background.visible = false;
    this.background = background;
};

BattleBackground.prototype.show = function() {
    this.background.visible = true;
};

BattleBackground.prototype.hide = function() {
    this.background.visible = false;
};

module.exports = BattleBackground;

},{}],31:[function(require,module,exports){
/* global Phaser */

function DialogComponent (game) {
    game.cache.addNinePatch('ninepatch_dialog', 'image_dialog', null, 8, 8, 16, 16);
    this.container = new Phaser.NinePatchImage(game, 96, 8, 'ninepatch_dialog');
    this.container.targetWidth = 152;
    this.container.targetHeight = 64
    this.container.fixedToCamera = true;
    this.chatTxt = [];
    this.lineCount = 3;
    for (var i = 0; i < this.lineCount; i++) {
        var chatLine = game.make.bitmapText(8, 8 + (i * 16), 'font_basic', '', 16, this.container);
        chatLine.maxWidth = 128;
        this.container.addChild(chatLine);
        this.chatTxt.push(chatLine);
    }
    this.container.visible = false;
    this.clear();
    game.time.events.loop(25, this.update, this);
};

DialogComponent.prototype.update = function() {
    if (this.buffer.length > 0) {
        // If we have more text to show, and we have reached lineCount
        if (this.currentLine >= this.lineCount) {
            this.currentLine--;
            for (var i = 0; i < (this.lineCount - 1); i++) {
                this.chatTxt[i].setText(this.chatTxt[i+1].text);
            }
            this.chatTxt[this.currentLine].setText('');
        }

        if (this.buffer[0].length > 0) {
            var c = this.buffer[0].substr(0, 1);
            this.buffer[0] = this.buffer[0].substr(1);
            this.chatTxt[this.currentLine].setText(this.chatTxt[this.currentLine].text + c);
        } else {
            this.buffer.shift();
            this.currentLine++;
        }
    }
};

DialogComponent.prototype.setText = function(text) {
    var line;
    do {
        // Private method I wish was Public
        line = this.chatTxt[0].scanLine(this.chatTxt[0]._data.font, 1, text);
        this.buffer.push(line.text);
        text = text.substr(line.text.length + 1);
    } while (line.end === false);
};

DialogComponent.prototype.show = function() {
    this.container.visible = true;
};

DialogComponent.prototype.hide = function() {
    this.container.visible = false;
    this.clear();
};

DialogComponent.prototype.clear = function() {
    this.buffer = [];
    this.currentLine = 0;
    for (var i = 0; i < this.lineCount; i++) {
        this.chatTxt[i].setText('');
    }
};

module.exports = DialogComponent;

},{}],32:[function(require,module,exports){
/* global Phaser */

function Frame(game, config) {
    game.cache.addNinePatch('ninepatch_dialog', 'image_dialog', null, 8, 8, 16, 16);
    var frame = new Phaser.NinePatchImage(game, config.x, config.y, 'ninepatch_dialog');
    frame.targetWidth = config.width;
    frame.targetHeight = config.height;
    frame.fixedToCamera = true;
    frame.visible = false;

    this.frame = frame;
};

Frame.prototype.show = function() {
    this.frame.visible = true;
};

Frame.prototype.hide = function() {
    this.frame.visible = false;
};

module.exports = Frame;

},{}],33:[function(require,module,exports){
function MatteComponent (game) {
    var matte = game.add.graphics(0, 0);
    matte.fixedToCamera = true;
    matte.alpha = 1;

    this.matte = matte;
    this.game = game;
};

MatteComponent.prototype.transition = function (color, alpha, time, callback) {
    callback = callback || function() {};

    var game = this.game;
    var matte = this.matte;
    matte.clear();
    matte.beginFill(color, 1);
    matte.drawRect(0, 0, game.width, game.height);
    matte.endFill();

    var s = this.game.add.tween(this.matte);
    s.to({ alpha: alpha }, time, null);
    s.onComplete.add(callback);
    s.start();
};

module.exports = MatteComponent;

},{}],34:[function(require,module,exports){
/* global Phaser */

function MenuComponent (game, options) {
    game.cache.addNinePatch('ninepatch_dialog', 'image_dialog', null, 8, 8, 16, 16);
    this.container = new Phaser.NinePatchImage(game, options.x, options.y, 'ninepatch_dialog');
    this.container.targetWidth = options.width;
    this.container.targetHeight = options.height
    this.container.fixedToCamera = true;

    this.menuItems = [];
    this.menuItemCount = options.rows;
    this.options = [];
    this.selection = 0;
    for (var i = 0; i < this.menuItemCount; i++) {
        var menuItem = game.make.bitmapText(8, 8 + (i * 16), 'font_basic', '', 16, this.container);
        menuItem.maxWidth = options.width - 24;
        this.container.addChild(menuItem);
        this.menuItems.push(menuItem);
    }
    this.container.visible = false;
    this.setOptions();
};

MenuComponent.prototype.setOptions = function(options) {
    this.options = options || [];
    this.selection = 0;
    this.reset();
};

MenuComponent.prototype.reset = function() {
    var options = this.options;
    for (var i = 0; i < this.menuItemCount; i++) {
        var option = options[i];
        this.menuItems[i].setText((this.selection === i ? '@ ' : '') + ((option && option.text) || ''));
    }
};

MenuComponent.prototype.selectionUp = function() {
    this.selection--;
    if (this.selection < 0) {
        this.selection = 0;
    }
    this.reset();
};

MenuComponent.prototype.selectionDown = function() {
    this.selection++;
    if (this.selection >= this.menuItemCount) {
        this.selection = this.menuItemCount - 1;
    }
    this.reset();
};

MenuComponent.prototype.getSelectedId = function() {
    return this.options &&
        this.options[this.selection] &&
        this.options[this.selection].id;
};

MenuComponent.prototype.show = function() {
    this.container.visible = true;
};

MenuComponent.prototype.hide = function() {
    this.container.visible = false;
};

module.exports = MenuComponent;

},{}],35:[function(require,module,exports){
module.exports = {
    menu: require('./Menu'),
    matte: require('./Matte'),
    frame: require('./Frame'),
    battlebg: require('./BattleBackground')
};

},{"./BattleBackground":30,"./Frame":32,"./Matte":33,"./Menu":34}],36:[function(require,module,exports){

var Config = {};

Config.load = function (config) {
    this.config = config;
};

Config.getResource = function (id) {
    var data = this.config.resources[id];
    if (!data) {
        throw 'Invalid Resouce ID - ' + id;
    }
    data.id = id;
    return data;
};

Config.getConfig = function (key) {
    return this.config[key];
}

module.exports = Config;

},{}],37:[function(require,module,exports){
/* global Phaser */

var Config = require('./Config');

var Loader = {};

Loader.loadResource = function (game, id) {
    var self = this;
    var dep = Config.getResource(id);

    switch (dep.type) {
        case 'image':
            if (game.cache.checkImageKey(dep.id)) {
                return;
            }
            game.load.image(dep.id, dep.path);
            break;

        case 'sprite':
            break;

        case 'map':
            if (game.cache.checkTilemapKey(dep.id)) {
                return;
            }
            game.load.tilemap(dep.id, dep.path, null, Phaser.Tilemap.TILED_JSON);
            if (dep.tileset) {
                dep.tileset.forEach(function(tilesetId) {
                    self.loadResource(game, tilesetId);
                });
            }
            if (dep.bgm) {
                self.loadResource(game, dep.bgm);
            }
            break;

        case 'resources':
            if (dep.resources) {
                dep.resources.forEach(function(rId) {
                    self.loadResource(game, rId);
                });
            }
            break;

        case 'audio':
            if (game.cache.checkSoundKey(dep.id)) {
                return;
            }
            game.load.audio(dep.id, dep.path);
            break;

        case 'bitmapfont':
            if (game.cache.checkBitmapFontKey(dep.id)) {
                return;
            }
            game.load.bitmapFont(dep.id, dep.path, dep.meta);
            break;
    }
};

module.exports = Loader;

},{"./Config":36}],38:[function(require,module,exports){
var noop = function(callback) {
    return callback();
};

function SubState(state, substates) {
    this.parentState = state;
    this.substates = substates;
    this.currentState = null;
}

SubState.prototype.switch = function (id) {
    var self = this;
    var transitionOut = self.currentState && self.currentState.transitionOut ?
        self.currentState.transitionOut.bind(self.currentState) : noop;

    transitionOut(function() {
        if (self.currentState && self.currentState.exit) {
            self.currentState.exit();
        }
        self.currentState = null;
        var SubState = self.substates[id];
        var newState = new SubState(self.parentState);
        var transitionIn = newState && newState.transitionIn ?
            newState.transitionIn.bind(newState) : noop;

        transitionIn(function() {
            self.currentState = newState;
            if (self.currentState && self.currentState.enter) {
                self.currentState.enter();
            }
        });
    });
};

SubState.prototype.update = function () {
    if (this.currentState && this.currentState.update) {
        this.currentState.update();
    }
}


module.exports = SubState;

},{}],39:[function(require,module,exports){
module.exports={
  "name": "earthbound-js",
  "version": "0.0.1",
  "description": "An Earthbound Demo in Javascipt",
  "main": "build/js/app.min.js",
  "scripts": {
    "lint": "eslint --quiet --cache . --ext .js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "Cary Stanley",
  "browser": {
    "Stats": "./js/lib/stats.min.js",
    "slopes": "./js/lib/phaser-arcade-slopes.min.js",
    "ninepatch": "./js/lib/nine-patch-phaser-plugin.min.js"
  },
  "devDependencies": {
    "browserify": "^13.0.0",
    "browserify-shim": "^3.8.12",
    "eslint": "^3.0.0",
    "grunt": "^0.4.5",
    "grunt-browserify": "^5.0.0",
    "grunt-cache-bust": "^1.1.1",
    "grunt-contrib-clean": "^1.0.0",
    "grunt-contrib-compress": "^1.1.1",
    "grunt-contrib-connect": "^1.0.0",
    "grunt-contrib-copy": "^1.0.0",
    "grunt-contrib-jade": "^1.0.0",
    "grunt-contrib-jshint": "^1.0.0",
    "grunt-contrib-stylus": "^1.2.0",
    "grunt-contrib-uglify": "^1.0.0",
    "grunt-contrib-watch": "^1.0.0",
    "grunt-open": "^0.2.3",
    "phaser": "2.4.8",
    "pre-commit": "^1.1.0"
  },
  "eslintConfig": {
    "es6": true
  },
  "pre-commit": [
    "lint"
  ]
}

},{}]},{},[8])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjb25maWcvY2hhcmFjdGVycy5qc29uIiwiY29uZmlnL2VuZW1pZXMuanNvbiIsImNvbmZpZy9ldmVudHMuanNvbiIsImNvbmZpZy9pdGVtcy5qc29uIiwiY29uZmlnL2xhbmcuanNvbiIsImNvbmZpZy9yZXNvdXJjZXMuanNvbiIsImNvbmZpZy91aS5qc29uIiwianMvYXBwLmpzIiwianMvZW50aXRpZXMvQ2hhcmFjdGVyLmpzIiwianMvZW50aXRpZXMvRW5lbXkuanMiLCJqcy9lbnRpdGllcy9Gb2xsb3dlci5qcyIsImpzL2VudGl0aWVzL1BsYXllci5qcyIsImpzL2VudGl0aWVzL1BsYXllckdyb3VwLmpzIiwianMvZXZlbnRzL0RpYWxvZ0V2ZW50LmpzIiwianMvZXZlbnRzL0V2ZW50LmpzIiwianMvZXZlbnRzL1NwYXduLmpzIiwianMvZXZlbnRzL1RyYW5zcG9ydEV2ZW50LmpzIiwianMvbWFwL01hcC5qcyIsImpzL3Byb3BlcnRpZXMuanMiLCJqcy9zdGF0ZXMvYm9vdC5qcyIsImpzL3N0YXRlcy9nYW1lLmpzIiwianMvc3RhdGVzL3ByZWxvYWRlci5qcyIsImpzL3N1YnN0YXRlcy9CYXR0bGUuanMiLCJqcy9zdWJzdGF0ZXMvRGlhbG9nLmpzIiwianMvc3Vic3RhdGVzL01lbnUuanMiLCJqcy9zdWJzdGF0ZXMvVHJhbnNpdGlvbi5qcyIsImpzL3N1YnN0YXRlcy9Xb3JsZC5qcyIsImpzL3N1YnN0YXRlcy9Xb3JsZEdvb2RzTWVudS5qcyIsImpzL3N1YnN0YXRlcy9Xb3JsZE1lbnUuanMiLCJqcy91aS9CYXR0bGVCYWNrZ3JvdW5kLmpzIiwianMvdWkvRGlhbG9nQ29tcG9uZW50LmpzIiwianMvdWkvRnJhbWUuanMiLCJqcy91aS9NYXR0ZS5qcyIsImpzL3VpL01lbnUuanMiLCJqcy91aS9pbmRleC5qcyIsImpzL3V0aWxzL0NvbmZpZy5qcyIsImpzL3V0aWxzL0xvYWRlci5qcyIsImpzL3V0aWxzL1N1YlN0YXRlLmpzIiwicGFja2FnZS5qc29uIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwibW9kdWxlLmV4cG9ydHM9e1xyXG4gIFwiaGVyb1wiOiB7XHJcbiAgICBcInN0YXRzXCI6IHtcclxuICAgICAgXCJvZmZcIjogMSxcclxuICAgICAgXCJkZWZcIjogMSxcclxuICAgICAgXCJzcGRcIjogMSxcclxuICAgICAgXCJndXRzXCI6IDEsXHJcbiAgICAgIFwidml0XCI6IDEsXHJcbiAgICAgIFwiaXFcIjogMjAsXHJcbiAgICAgIFwibHVja1wiOiAxXHJcbiAgICB9LFxyXG4gICAgXCJlcXVpcFwiOiB7XHJcbiAgICAgIFwid2VhcG9uXCI6IG51bGwsXHJcbiAgICAgIFwiYXJtXCI6IG51bGwsXHJcbiAgICAgIFwiYm9keVwiOiBudWxsLFxyXG4gICAgICBcIm90aGVyXCI6IG51bGxcclxuICAgIH0sXHJcbiAgICBcInNwcml0ZVwiOiBcImhlcm9cIixcclxuICAgIFwibGV2ZWxcIjogMSxcclxuICB9XHJcbn1cclxuIiwibW9kdWxlLmV4cG9ydHM9e1xyXG4gIFwibXVzaHJvb21cIjoge1xyXG4gICAgXCJzdGF0c1wiOiB7XHJcbiAgICAgIFwiaHBcIjogMTAsXHJcbiAgICAgIFwiZGVmXCI6IDUsXHJcbiAgICAgIFwib2ZmXCI6IDMsXHJcbiAgICAgIFwiZ3V0c1wiOiAxMCxcclxuICAgICAgXCJsdWNrXCI6IDMwLFxyXG4gICAgICBcIm1pc3NcIjogMjBcclxuICAgIH0sXHJcbiAgICBcInhwXCI6IDYsXHJcbiAgICBcIm1vbmV5XCI6IDYsXHJcbiAgICBcImxldmVsXCI6IDIsXHJcbiAgICBcIm11c2ljXCI6IFwic2lsbHlcIixcclxuICAgIFwic3RyYXRlZ3lcIjogXCJyYW5kb21cIixcclxuICAgIFwiYWN0aW9uc1wiOiBbXCJiYXNoXCIsIFwiaGVhbFwiLCBcImJhc2hcIiwgXCJtdXNocm9vbVwiXSxcclxuICAgIFwiZHJvcFwiOiBcImZ1bmdpXCIsXHJcbiAgICBcImRyb3BmcmVxXCI6IDIsXHJcbiAgICBcInN0YXR1c1wiOiBcIm5vcm1hbFwiXHJcbiAgfVxyXG59XHJcbiIsIm1vZHVsZS5leHBvcnRzPXtcclxuICBcInNvbWVldmVudFwiOiB7XHJcbiAgICBcInBhZ2VzXCI6IFt7XHJcbiAgICAgIFwidHJpZ2dlclwiOiBcImFjdGlvblwiLFxyXG4gICAgICBcInR5cGVcIjogXCJmaXhlZFwiLFxyXG4gICAgICBcInNwcml0ZVwiOiBcInNvbWVzcHJpdGVpZFwiLFxyXG4gICAgICBcImNvbmRpdGlvbnNcIjoge30sXHJcbiAgICAgIFwiY29tbWFuZHNcIjogW11cclxuICAgIH1dXHJcbiAgfVxyXG59XHJcbiIsIm1vZHVsZS5leHBvcnRzPXtcclxuICBcImNyYWNrZWRiYXRcIjoge1xyXG4gICAgXCJ0eXBlXCI6IFwid2VhcG9uXCIsXHJcbiAgICBcImNvc3RcIjogMTgsXHJcbiAgICBcInN0YXRzXCI6IHtcclxuICAgICAgXCJvZmZcIjogNFxyXG4gICAgfVxyXG4gIH0sXHJcbiAgXCJyYW1lblwiOiB7XHJcbiAgICBcInR5cGVcIjogXCJmb29kXCIsXHJcbiAgICBcImNvc3RcIjogMTIsXHJcbiAgICBcInN0YXRzXCI6IHtcclxuICAgICAgXCJocFwiOiAzMFxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCJtb2R1bGUuZXhwb3J0cz17XHJcbiAgICBcIkNIQVJBQ1RFUl9OQU1FX2hlcm9cIjogXCJJenVtaVwiLFxyXG5cclxuICAgIFwiSVRFTV9OQU1FX3JhbWVuXCI6IFwiUmFtZW5cIixcclxuXHJcbiAgICBcIkVORU1ZX05BTUVfbXVzaHJvb21cIjogXCJNdXNocm9vbVwiXHJcbn1cclxuIiwibW9kdWxlLmV4cG9ydHM9e1xyXG4gIFwibWFwX2hvdXNlXCI6IHtcInR5cGVcIjogXCJtYXBcIiwgXCJwYXRoXCI6IFwibWFwcy9ob3VzZS5qc29uXCIsXHJcbiAgICBcInRpbGVzZXRcIjogW1widGlsZXNfaG91c2VcIl0sXHJcbiAgICBcImJnbVwiOiBcImJnbV9ib3ltZWV0c2dpcmxcIlxyXG4gIH0sXHJcblxyXG4gIFwidGlsZXNfaG91c2VcIjoge1widHlwZVwiOiBcImltYWdlXCIsIFwicGF0aFwiOiBcImltYWdlcy9ob3VzZV90aWxlc2V0LnBuZ1wifSxcclxuXHJcbiAgXCJpbWFnZV9kaWFsb2dcIjoge1widHlwZVwiOiBcImltYWdlXCIsIFwicGF0aFwiOiBcImltYWdlcy9kaWFsb2cucG5nXCJ9LFxyXG4gIFwiYmF0dGxlYmdfMVwiOiB7XCJ0eXBlXCI6IFwiaW1hZ2VcIiwgXCJwYXRoXCI6IFwiaW1hZ2VzL2JhdHRsZWJnLzEucG5nXCJ9LFxyXG5cclxuICBcImZvbnRfYmFzaWNcIjoge1widHlwZVwiOiBcImJpdG1hcGZvbnRcIiwgXCJwYXRoXCI6IFwiZm9udHMvYmFzaWMucG5nXCIsIFwibWV0YVwiOiBcImZvbnRzL2Jhc2ljLnhtbFwifSxcclxuICBcImZvbnRfbXJzYXR1cm5cIjoge1widHlwZVwiOiBcImJpdG1hcGZvbnRcIiwgXCJwYXRoXCI6IFwiZm9udHMvbXJzYXR1cm4ucG5nXCIsIFwibWV0YVwiOiBcImZvbnRzL21yc2F0dXJuLnhtbFwifSxcclxuXHJcbiAgXCJzZnhfZG9vcl9vcGVuXCI6IHtcInR5cGVcIjogXCJhdWRpb1wiLCBcInBhdGhcIjogW1wiYXVkaW8vZWZmZWN0X2Rvb3Jfb3Blbi53YXZcIl19LFxyXG4gIFwiYmdtX2JveW1lZXRzZ2lybFwiOiB7XCJ0eXBlXCI6IFwiYXVkaW9cIiwgXCJwYXRoXCI6IFtcImF1ZGlvL2JhY2tncm91bmRfYm95bWVldHNnaXJsLm1wM1wiXX0sXHJcblxyXG4gIFwiZGVmYXVsdFwiOiB7XCJ0eXBlXCI6IFwicmVzb3VyY2VzXCIsIFwicmVzb3VyY2VzXCI6IFtcImltYWdlX2RpYWxvZ1wiLCBcImZvbnRfYmFzaWNcIiwgXCJzZnhfZG9vcl9vcGVuXCIsIFwiYmF0dGxlYmdfMVwiXX1cclxufVxyXG4iLCJtb2R1bGUuZXhwb3J0cz17XHJcbiAgICBcIndvcmxkbWVudVwiOiB7XHJcbiAgICAgICAgXCJ0eXBlXCI6IFwibWVudVwiLFxyXG4gICAgICAgIFwieFwiOiA4LFxyXG4gICAgICAgIFwieVwiOiA4LFxyXG4gICAgICAgIFwid2lkdGhcIjogNjQsXHJcbiAgICAgICAgXCJoZWlnaHRcIjogNjQsXHJcbiAgICAgICAgXCJyb3dzXCI6IDNcclxuICAgIH0sXHJcbiAgICBcIndvcmxkZ29vZHNtZW51XCI6IHtcclxuICAgICAgICBcInR5cGVcIjogXCJtZW51XCIsXHJcbiAgICAgICAgXCJ4XCI6IDMyLFxyXG4gICAgICAgIFwieVwiOiAzMixcclxuICAgICAgICBcIndpZHRoXCI6IDE1MixcclxuICAgICAgICBcImhlaWdodFwiOiA2NCxcclxuICAgICAgICBcInJvd3NcIjogM1xyXG4gICAgfSxcclxuICAgIFwibWF0dGVcIjoge1xyXG4gICAgICAgIFwidHlwZVwiOiBcIm1hdHRlXCJcclxuICAgIH0sXHJcbiAgICBcIm5ld1wiOiB7XHJcbiAgICAgICAgXCJ0eXBlXCI6IFwiZnJhbWVcIixcclxuICAgICAgICBcInhcIjogOCxcclxuICAgICAgICBcInlcIjogOCxcclxuICAgICAgICBcIndpZHRoXCI6IDY0LFxyXG4gICAgICAgIFwiaGVpZ2h0XCI6IDY0XHJcbiAgICB9LFxyXG4gICAgXCJiYXR0bGViZ1wiOiB7XHJcbiAgICAgICAgXCJ0eXBlXCI6IFwiYmF0dGxlYmdcIlxyXG4gICAgfVxyXG59XHJcbiIsIi8qIGdsb2JhbCBQaGFzZXIgKi9cclxuXHJcbnZhciBwcm9wZXJ0aWVzID0gcmVxdWlyZSgnLi9wcm9wZXJ0aWVzJyk7XHJcbnZhciBzdGF0ZXMgPSB7XHJcbiAgICBib290OiByZXF1aXJlKCcuL3N0YXRlcy9ib290LmpzJyksXHJcbiAgICBwcmVsb2FkZXI6IHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlci5qcycpLFxyXG4gICAgZ2FtZTogcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZS5qcycpXHJcbn07XHJcbnZhciBnYW1lID0gbmV3IFBoYXNlci5HYW1lKHByb3BlcnRpZXMuc2l6ZS54LCBwcm9wZXJ0aWVzLnNpemUueSwgUGhhc2VyLkFVVE8sICdnYW1lJywgbnVsbCwgZmFsc2UsIGZhbHNlKTtcclxuXHJcbnZhciBDb25maWcgPSByZXF1aXJlKCcuL3V0aWxzL0NvbmZpZycpO1xyXG5Db25maWcubG9hZCh7XHJcbiAgICByZXNvdXJjZXM6IHJlcXVpcmUoJy4uL2NvbmZpZy9yZXNvdXJjZXMuanNvbicpLFxyXG4gICAgY2hhcmFjdGVyczogcmVxdWlyZSgnLi4vY29uZmlnL2NoYXJhY3RlcnMuanNvbicpLFxyXG4gICAgZW5lbWllczogcmVxdWlyZSgnLi4vY29uZmlnL2VuZW1pZXMuanNvbicpLFxyXG4gICAgZXZlbnRzOiByZXF1aXJlKCcuLi9jb25maWcvZXZlbnRzLmpzb24nKSxcclxuICAgIGl0ZW1zOiByZXF1aXJlKCcuLi9jb25maWcvaXRlbXMuanNvbicpLFxyXG4gICAgbGFuZzogcmVxdWlyZSgnLi4vY29uZmlnL2xhbmcuanNvbicpLFxyXG4gICAgdWk6IHJlcXVpcmUoJy4uL2NvbmZpZy91aS5qc29uJykgICAgXHJcbn0pO1xyXG5cclxuLy8gQXV0b21hdGljYWxseSByZWdpc3RlciBlYWNoIHN0YXRlLlxyXG5PYmplY3Qua2V5cyhzdGF0ZXMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XHJcbiAgICB2YXIgc3RhdGUgPSBzdGF0ZXNba2V5XTtcclxuICAgIGdhbWUuc3RhdGUuYWRkKGtleSwgc3RhdGUpO1xyXG59KTtcclxuXHJcbmdhbWUuc3RhdGUuc3RhcnQoJ2Jvb3QnKTtcclxuIiwiLyogZ2xvYmFsIFBoYXNlciAqL1xyXG5cclxuZnVuY3Rpb24gQ2hhcmFjdGVyKGdhbWUsIHgsIHksIHNraW4sIHBoeXNpY3MpIHtcclxuICAgIHZhciBvZmZlc3QgPSBza2luICogODtcclxuICAgIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAnYWN0b3JzJywgb2ZmZXN0ICsgNCk7XHJcbiAgICB0aGlzLmFuaW1hdGlvbnMuYWRkKCd1cCcsIFtvZmZlc3QgKyAwLCBvZmZlc3QgKyAxXSwgNSwgdHJ1ZSk7XHJcbiAgICB0aGlzLmFuaW1hdGlvbnMuYWRkKCdyaWdodCcsIFtvZmZlc3QgKyAyLCBvZmZlc3QgKyAzXSwgMTAsIHRydWUpO1xyXG4gICAgdGhpcy5hbmltYXRpb25zLmFkZCgnZG93bicsIFtvZmZlc3QgKyA0LCBvZmZlc3QgKyA1XSwgNSwgdHJ1ZSk7XHJcbiAgICB0aGlzLmFuaW1hdGlvbnMuYWRkKCdsZWZ0JywgW29mZmVzdCArIDYsIG9mZmVzdCArIDddLCAxMCwgdHJ1ZSk7XHJcblxyXG4gICAgdGhpcy5hbmNob3Iuc2V0VG8oMC41LCAxKTtcclxuXHJcbiAgICBpZiAocGh5c2ljcykge1xyXG4gICAgICAgIGdhbWUucGh5c2ljcy5hcmNhZGUuZW5hYmxlKHRoaXMpO1xyXG4gICAgICAgIHRoaXMuYm9keS5zZXRTaXplKDE0LCA3LCA1LCAyNyk7XHJcbiAgICAgICAgZ2FtZS5zbG9wZXMuZW5hYmxlKHRoaXMpO1xyXG4gICAgfVxyXG59XHJcblxyXG5DaGFyYWN0ZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XHJcbkNoYXJhY3Rlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDaGFyYWN0ZXI7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IENoYXJhY3RlcjtcclxuIiwidmFyIENoYXJhY3RlciA9IHJlcXVpcmUoJy4vQ2hhcmFjdGVyJyk7XHJcblxyXG5mdW5jdGlvbiBFbmVteShnYW1lLCB0eXBlLCB4LCB5KSB7XHJcbiAgICBDaGFyYWN0ZXIuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCA3LCB0cnVlKTtcclxuICAgIHRoaXMudGltZXIgPSAwO1xyXG4gICAgdGhpcy5hY2NlbCA9IDgwO1xyXG4gICAgdGhpcy52aXNMaWZlID0gNjA7XHJcblxyXG4gICAgdGhpcy52ZWxYID0gMDtcclxuICAgIHRoaXMudmVsWSA9IDA7XHJcbn1cclxuXHJcbkVuZW15LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2hhcmFjdGVyLnByb3RvdHlwZSk7XHJcbkVuZW15LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEVuZW15O1xyXG5cclxuRW5lbXkucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICghdGhpcy5pbkNhbWVyYSkge1xyXG4gICAgICAgIHRoaXMudmlzTGlmZS0tO1xyXG4gICAgICAgIGlmICh0aGlzLnZpc0xpZmUgPCAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMua2lsbCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnZpc0xpZmUgPSA2MDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5nYW1lLnN0YXRlLmdldEN1cnJlbnRTdGF0ZSgpLnBsYXllckRpc2FibGVkKSB7XHJcbiAgICAgICAgdGhpcy5ib2R5LnZlbG9jaXR5LnggPSAwO1xyXG4gICAgICAgIHRoaXMuYm9keS52ZWxvY2l0eS55ID0gMDtcclxuICAgICAgICB0aGlzLmFuaW1hdGlvbnMuc3RvcCgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnRpbWVyLS07XHJcbiAgICBpZiAodGhpcy50aW1lciA8PSAwKSB7XHJcbiAgICAgICAgdGhpcy52ZWxYID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMiAtIDEpICogdGhpcy5hY2NlbDtcclxuICAgICAgICB0aGlzLnZlbFkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyIC0gMSkgKiB0aGlzLmFjY2VsO1xyXG4gICAgICAgIHRoaXMudGltZXIgPSA2MDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmJvZHkudmVsb2NpdHkueCA9IHRoaXMudmVsWDtcclxuICAgIHRoaXMuYm9keS52ZWxvY2l0eS55ID0gdGhpcy52ZWxZO1xyXG5cclxuICAgIHZhciBkaXJlY3Rpb24gPSBudWxsO1xyXG5cclxuICAgIGlmICgodGhpcy5ib2R5LnZlbG9jaXR5LnggPCB0aGlzLmJvZHkudmVsb2NpdHkueSkgJiYgKHRoaXMuYm9keS52ZWxvY2l0eS54IDwgMCkpXHJcbiAgICB7XHJcbiAgICAgICAgZGlyZWN0aW9uID0gJ2xlZnQnO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoKHRoaXMuYm9keS52ZWxvY2l0eS54ID4gdGhpcy5ib2R5LnZlbG9jaXR5LnkpICYmICh0aGlzLmJvZHkudmVsb2NpdHkueCA+IDApKVxyXG4gICAge1xyXG4gICAgICAgIGRpcmVjdGlvbiA9ICdyaWdodCc7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCh0aGlzLmJvZHkudmVsb2NpdHkueSA8IHRoaXMuYm9keS52ZWxvY2l0eS54KSAmJiAodGhpcy5ib2R5LnZlbG9jaXR5LnkgPCAwKSlcclxuICAgIHtcclxuICAgICAgICBkaXJlY3Rpb24gPSAndXAnO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoKHRoaXMuYm9keS52ZWxvY2l0eS55ID4gdGhpcy5ib2R5LnZlbG9jaXR5LngpICYmICh0aGlzLmJvZHkudmVsb2NpdHkueSA+IDApKVxyXG4gICAge1xyXG4gICAgICAgIGRpcmVjdGlvbiA9ICdkb3duJztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5wbGF5KGRpcmVjdGlvbik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9ucy5zdG9wKCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5FbmVteS5wcm90b3R5cGUub25Ub3VjaCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5nYW1lLnN0YXRlLmdldEN1cnJlbnRTdGF0ZSgpLnN3aXRjaFN1YlN0YXRlKCdiYXR0bGUnKTtcclxuICAgIHRoaXMua2lsbCgpO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBFbmVteTtcclxuIiwidmFyIENoYXJhY3RlciA9IHJlcXVpcmUoJy4vQ2hhcmFjdGVyJyk7XHJcblxyXG5mdW5jdGlvbiBGb2xsb3dlcihnYW1lLCBza2luLCBmb2xsb3dDaGFyYWN0ZXIpIHtcclxuICAgIENoYXJhY3Rlci5jYWxsKHRoaXMsIGdhbWUsIGZvbGxvd0NoYXJhY3Rlci54LCBmb2xsb3dDaGFyYWN0ZXIueSwgc2tpbiwgZmFsc2UpO1xyXG4gICAgdGhpcy5pbml0UXVldWUoZm9sbG93Q2hhcmFjdGVyLCAxNik7XHJcbn1cclxuXHJcbkZvbGxvd2VyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2hhcmFjdGVyLnByb3RvdHlwZSk7XHJcbkZvbGxvd2VyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEZvbGxvd2VyO1xyXG5cclxuRm9sbG93ZXIucHJvdG90eXBlLmluaXRRdWV1ZSA9IGZ1bmN0aW9uKGZvbGxvd0NoYXJhY3RlciwgZm9sbG93TWF4KSB7XHJcbiAgICB0aGlzLmZvbGxvd0NoYXJhY3RlciA9IGZvbGxvd0NoYXJhY3RlcjtcclxuICAgIHRoaXMuZm9sbG93UXVldWUgPSBbXTtcclxuICAgIHRoaXMubGVhZGVyQ3Vyc29yID0gMDtcclxuICAgIHRoaXMuZm9sbG93ZXJDdXJzb3IgPSAxO1xyXG4gICAgdGhpcy5mb2xsb3dNYXggPSBmb2xsb3dNYXg7XHJcbiAgICBmb3IgKHZhciBmID0gMDsgZiA8IGZvbGxvd01heDsgZisrKSB7XHJcbiAgICAgICAgdGhpcy5mb2xsb3dRdWV1ZVtmXSA9IHthbmltYXRpb246ICdkb3duJywgeDogZm9sbG93Q2hhcmFjdGVyLngsIHk6IGZvbGxvd0NoYXJhY3Rlci55fTtcclxuICAgIH1cclxufTtcclxuXHJcbkZvbGxvd2VyLnByb3RvdHlwZS51cGRhdGVRdWV1ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5sZWFkZXJDdXJzb3IgPSAodGhpcy5sZWFkZXJDdXJzb3IgKyAxKSAlIHRoaXMuZm9sbG93TWF4O1xyXG4gICAgdGhpcy5mb2xsb3dlckN1cnNvciA9ICh0aGlzLmZvbGxvd2VyQ3Vyc29yICsgMSkgJSB0aGlzLmZvbGxvd01heDtcclxuICAgIHRoaXMuZm9sbG93UXVldWVbdGhpcy5sZWFkZXJDdXJzb3JdLmFuaW1hdGlvbiA9IHRoaXMuZm9sbG93Q2hhcmFjdGVyLmFuaW1hdGlvbnMuY3VycmVudEFuaW0ubmFtZTtcclxuICAgIHRoaXMuZm9sbG93UXVldWVbdGhpcy5sZWFkZXJDdXJzb3JdLnggPSB0aGlzLmZvbGxvd0NoYXJhY3Rlci54O1xyXG4gICAgdGhpcy5mb2xsb3dRdWV1ZVt0aGlzLmxlYWRlckN1cnNvcl0ueSA9IHRoaXMuZm9sbG93Q2hhcmFjdGVyLnk7XHJcbiAgICB2YXIgZm9sbG93ZXJNZXRhID0gdGhpcy5mb2xsb3dRdWV1ZVt0aGlzLmZvbGxvd2VyQ3Vyc29yXTtcclxuICAgIHRoaXMueCA9IGZvbGxvd2VyTWV0YS54O1xyXG4gICAgdGhpcy55ID0gZm9sbG93ZXJNZXRhLnk7XHJcbiAgICB0aGlzLnBsYXkoZm9sbG93ZXJNZXRhLmFuaW1hdGlvbik7XHJcbn07XHJcblxyXG5Gb2xsb3dlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHRoaXMuZ2FtZS5zdGF0ZS5nZXRDdXJyZW50U3RhdGUoKS5wbGF5ZXJEaXNhYmxlZCkge1xyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9ucy5zdG9wKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEhhbmRsZSBGb2xsb3dpbmdcclxuICAgIGlmICh0aGlzLmZvbGxvd0NoYXJhY3Rlci5hbmltYXRpb25zLmN1cnJlbnRBbmltLmlzUGxheWluZykge1xyXG4gICAgICAgIHRoaXMudXBkYXRlUXVldWUoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb25zLnN0b3AoKTtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBGb2xsb3dlcjtcclxuIiwidmFyIENoYXJhY3RlciA9IHJlcXVpcmUoJy4vQ2hhcmFjdGVyJyk7XHJcblxyXG5mdW5jdGlvbiBQbGF5ZXIoZ2FtZSwgbWFwLCB4LCB5LCBza2luKSB7XHJcbiAgICBDaGFyYWN0ZXIuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCBza2luLCB0cnVlKTtcclxuICAgIHRoaXMubWFwID0gbWFwO1xyXG5cclxuICAgIC8vIHRoaXMuYm9keS5kcmFnLnggPSA2NDA7XHJcbiAgICAvLyB0aGlzLmJvZHkuZHJhZy55ID0gNjQwO1xyXG4gICAgLy8gdGhpcy5ib2R5Lm1heFZlbG9jaXR5LnggPSA4MDtcclxuICAgIC8vIHRoaXMuYm9keS5tYXhWZWxvY2l0eS55ID0gODA7XHJcbiAgICB0aGlzLmFjY2VsID0gODA7XHJcbn1cclxuXHJcblBsYXllci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKENoYXJhY3Rlci5wcm90b3R5cGUpO1xyXG5QbGF5ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGxheWVyO1xyXG5cclxuUGxheWVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmJvZHkudmVsb2NpdHkueCA9IDA7XHJcbiAgICB0aGlzLmJvZHkudmVsb2NpdHkueSA9IDA7XHJcbiAgICBpZiAodGhpcy5nYW1lLnN0YXRlLmdldEN1cnJlbnRTdGF0ZSgpLnBsYXllckRpc2FibGVkKSB7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb25zLnN0b3AoKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGRpcmVjdGlvbiA9IG51bGw7XHJcbiAgICB2YXIgY3Vyc29ycyA9IHRoaXMuZ2FtZS5zdGF0ZS5nZXRDdXJyZW50U3RhdGUoKS5jdXJzb3JzO1xyXG5cclxuICAgIGlmIChjdXJzb3JzLmxlZnQuaXNEb3duKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuYm9keS52ZWxvY2l0eS54ID0gLXRoaXMuYWNjZWw7XHJcbiAgICAgICAgZGlyZWN0aW9uID0gJ2xlZnQnO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoY3Vyc29ycy5yaWdodC5pc0Rvd24pXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5ib2R5LnZlbG9jaXR5LnggPSB0aGlzLmFjY2VsO1xyXG4gICAgICAgIGRpcmVjdGlvbiA9ICdyaWdodCc7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGN1cnNvcnMudXAuaXNEb3duKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuYm9keS52ZWxvY2l0eS55ID0gLXRoaXMuYWNjZWw7XHJcbiAgICAgICAgZGlyZWN0aW9uID0gJ3VwJztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGN1cnNvcnMuZG93bi5pc0Rvd24pXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5ib2R5LnZlbG9jaXR5LnkgPSB0aGlzLmFjY2VsO1xyXG4gICAgICAgIGRpcmVjdGlvbiA9ICdkb3duJztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5wbGF5KGRpcmVjdGlvbik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9ucy5zdG9wKCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXllcjtcclxuIiwiLyogZ2xvYmFsIFBoYXNlciAqL1xyXG5cclxudmFyIEZvbGxvd2VyID0gcmVxdWlyZSgnLi9Gb2xsb3dlcicpO1xyXG52YXIgUGxheWVyID0gcmVxdWlyZSgnLi9QbGF5ZXInKTtcclxuXHJcbmZ1bmN0aW9uIFBsYXllckdyb3VwKGdhbWUsIGN1cnJlbnRNYXAsIHgsIHkpIHtcclxuICAgIFBoYXNlci5Hcm91cC5jYWxsKHRoaXMsIGdhbWUpO1xyXG4gICAgdGhpcy5wbGF5ZXIgPSBuZXcgUGxheWVyKGdhbWUsIGN1cnJlbnRNYXAsIHgsIHksIDApO1xyXG4gICAgdmFyIGZvbGxvd2VyID0gbmV3IEZvbGxvd2VyKGdhbWUsIDEsIHRoaXMucGxheWVyKTtcclxuICAgIHZhciBmb2xsb3dlcjIgPSBuZXcgRm9sbG93ZXIoZ2FtZSwgMiwgZm9sbG93ZXIpO1xyXG4gICAgdGhpcy5hZGQodGhpcy5wbGF5ZXIpO1xyXG4gICAgdGhpcy5hZGQoZm9sbG93ZXIpO1xyXG4gICAgdGhpcy5hZGQoZm9sbG93ZXIyKTtcclxufVxyXG5cclxuUGxheWVyR3JvdXAucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuR3JvdXAucHJvdG90eXBlKTtcclxuUGxheWVyR3JvdXAucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGxheWVyR3JvdXA7XHJcblxyXG5QbGF5ZXJHcm91cC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoeCwgeSkge1xyXG4gICAgdGhpcy5wbGF5ZXIucmVzZXQoeCwgeSk7XHJcbn07XHJcblxyXG5QbGF5ZXJHcm91cC5wcm90b3R5cGUuZ2V0TGVhZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGxheWVyO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXJHcm91cDtcclxuIiwidmFyIEV2ZW50ID0gcmVxdWlyZSgnLi9FdmVudCcpO1xyXG5cclxuZnVuY3Rpb24gRGlhbG9nRXZlbnQoZ2FtZSwgc2V0dGluZ3MpIHtcclxuICAgIEV2ZW50LmNhbGwodGhpcywgZ2FtZSwgc2V0dGluZ3MpO1xyXG59XHJcblxyXG5EaWFsb2dFdmVudC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEV2ZW50LnByb3RvdHlwZSk7XHJcbkRpYWxvZ0V2ZW50LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IERpYWxvZ0V2ZW50O1xyXG5cclxuRGlhbG9nRXZlbnQucHJvdG90eXBlLm9uVG91Y2ggPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5zZXR0aW5ncy5wcm9wZXJ0aWVzO1xyXG4gICAgdGhpcy5nYW1lLnNob3dEaWFsb2cocHJvcGVydGllcy50ZXh0KTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRGlhbG9nRXZlbnQ7XHJcbiIsIi8qIGdsb2JhbCBQaGFzZXIgKi9cclxuXHJcbmZ1bmN0aW9uIEV2ZW50KGdhbWUsIHNldHRpbmdzKSB7XHJcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xyXG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG5cclxuICAgIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCBzZXR0aW5ncy54IHx8IDAsIHNldHRpbmdzLnkgfHwgMCk7XHJcbiAgICB0aGlzLnJlbmRlcmFibGUgPSBmYWxzZTtcclxuICAgIHRoaXMud2lkdGggPSBzZXR0aW5ncy53aWR0aCB8fCAxNjtcclxuICAgIHRoaXMuaGVpZ2h0ID0gc2V0dGluZ3MuaGVpZ2h0IHx8IDE2O1xyXG4gICAgZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUodGhpcyk7XHJcbiAgICB0aGlzLmJvZHkuaW1tb3ZhYmxlID0gdHJ1ZTtcclxufVxyXG5cclxuRXZlbnQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XHJcbkV2ZW50LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEV2ZW50O1xyXG5cclxuRXZlbnQucHJvdG90eXBlLm9uVG91Y2ggPSBmdW5jdGlvbigpIHt9O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBFdmVudDtcclxuIiwidmFyIEV2ZW50ID0gcmVxdWlyZSgnLi9FdmVudCcpO1xyXG5cclxuZnVuY3Rpb24gU3Bhd24oZ2FtZSwgc2V0dGluZ3MpIHtcclxuICAgIEV2ZW50LmNhbGwodGhpcywgZ2FtZSwgc2V0dGluZ3MpO1xyXG4gICAgdGhpcy5mbGFnSXNWaXNpYmxlID0gZmFsc2U7XHJcbn1cclxuXHJcblNwYXduLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXZlbnQucHJvdG90eXBlKTtcclxuU3Bhd24ucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3Bhd247XHJcblxyXG5TcGF3bi5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAodGhpcy5pbkNhbWVyYSAmJiAhdGhpcy5mbGFnSXNWaXNpYmxlKSB7XHJcbiAgICAgICAgdGhpcy5mbGFnSXNWaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm9uVmlzaWJsZSgpO1xyXG4gICAgfSBlbHNlIGlmICghdGhpcy5pbkNhbWVyYSAmJiB0aGlzLmZsYWdJc1Zpc2libGUpIHtcclxuICAgICAgICB0aGlzLmZsYWdJc1Zpc2libGUgPSBmYWxzZTtcclxuICAgIH1cclxufVxyXG5cclxuU3Bhd24ucHJvdG90eXBlLm9uVmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5nYW1lLnNwYXduRW5lbXkodGhpcy5zZXR0aW5ncy50eXBlLCB0aGlzLmJvZHkueCArIHRoaXMuYm9keS53aWR0aCAvIDIsIHRoaXMuYm9keS55ICsgdGhpcy5ib2R5LmhlaWdodCAvIDIpO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBTcGF3bjtcclxuIiwidmFyIEV2ZW50ID0gcmVxdWlyZSgnLi9FdmVudCcpO1xyXG5cclxuZnVuY3Rpb24gVHJhbnNwb3J0RXZlbnQoZ2FtZSwgc2V0dGluZ3MpIHtcclxuICAgIEV2ZW50LmNhbGwodGhpcywgZ2FtZSwgc2V0dGluZ3MpO1xyXG59XHJcblxyXG5UcmFuc3BvcnRFdmVudC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEV2ZW50LnByb3RvdHlwZSk7XHJcblRyYW5zcG9ydEV2ZW50LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFRyYW5zcG9ydEV2ZW50O1xyXG5cclxuVHJhbnNwb3J0RXZlbnQucHJvdG90eXBlLm9uVG91Y2ggPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5zZXR0aW5ncy5wcm9wZXJ0aWVzO1xyXG4gICAgdGhpcy5nYW1lLnRyYW5zcG9ydChwcm9wZXJ0aWVzLm1hcCwgcHJvcGVydGllcy5sb2NhdGlvbik7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFRyYW5zcG9ydEV2ZW50O1xyXG4iLCJ2YXIgRXZlbnRUeXBlcyA9IHtcclxuICAgIHRyYW5zcG9ydDogcmVxdWlyZSgnLi4vZXZlbnRzL1RyYW5zcG9ydEV2ZW50JyksXHJcbiAgICBkaWFsb2c6IHJlcXVpcmUoJy4uL2V2ZW50cy9EaWFsb2dFdmVudCcpXHJcbn07XHJcbnZhciBTcGF3biA9IHJlcXVpcmUoJy4uL2V2ZW50cy9TcGF3bicpO1xyXG5cclxuZnVuY3Rpb24gTWFwKGdhbWUsIGNvbmZpZykge1xyXG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcclxuICAgIHRoaXMuaWQgPSBjb25maWcuaWQ7XHJcbiAgICB0aGlzLm1hcCA9IGdhbWUuYWRkLnRpbGVtYXAoY29uZmlnLmlkKTtcclxuICAgIGNvbmZpZy50aWxlc2V0LmZvckVhY2goZnVuY3Rpb24odGlsZXNldCkge1xyXG4gICAgICAgIHRoaXMubWFwLmFkZFRpbGVzZXRJbWFnZSh0aWxlc2V0LCB0aWxlc2V0KTtcclxuICAgIH0sIHRoaXMpO1xyXG5cclxuICAgIGdhbWUud29ybGQuc2V0Qm91bmRzKDAsIDAsIHRoaXMubWFwLndpZHRoSW5QaXhlbHMsIHRoaXMubWFwLmhlaWdodEluUGl4ZWxzKTtcclxuXHJcbiAgICB0aGlzLmJhY2tncm91bmRMYXllciA9IHRoaXMubWFwLmNyZWF0ZUxheWVyKCdiYWNrZ3JvdW5kJyk7XHJcbiAgICB0aGlzLmZvcmVncm91bmRMYXllciA9IHRoaXMubWFwLmNyZWF0ZUxheWVyKCdmb3JlZ3JvdW5kJyk7XHJcbiAgICAvLyBmbG9hdGluZ0xheWVyID0gbWFwLmNyZWF0ZUxheWVyKCdmbG9hdGluZycpO1xyXG5cclxuICAgIHRoaXMubG9jYXRpb25zID0gdGhpcy5zZXR1cExvY2F0aW9ucyh0aGlzLm1hcCk7XHJcbiAgICB0aGlzLmV2ZW50cyA9IHRoaXMuc2V0dXBFdmVudHModGhpcy5nYW1lLCB0aGlzLm1hcCk7XHJcbiAgICB0aGlzLnNwYXducyA9IHRoaXMuc2V0dXBTcGF3bnModGhpcy5nYW1lLCB0aGlzLm1hcCk7XHJcblxyXG4gICAgdmFyIHNsb3BlTG9va3VwID0ge1xyXG4gICAgICAgIDI5MTogbnVsbCxcclxuICAgICAgICAxNTg6ICdIQUxGX1RPUF9SSUdIVCcsXHJcbiAgICAgICAgMTU5OiAnSEFMRl9UT1BfTEVGVCcsXHJcbiAgICAgICAgOTc6IG51bGwsXHJcbiAgICAgICAgODA6ICdIQUxGX1RPUF9SSUdIVCcsXHJcbiAgICAgICAgODE6ICdIQUxGX1RPUF9MRUZUJyxcclxuICAgICAgICA4MjogJ0hBTEZfVE9QX0xFRlQnXHJcbiAgICB9XHJcbiAgICB2YXIgc2xvcGVNYXAgPSBbXTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDI5MTsgaSsrKSB7XHJcbiAgICAgICAgc2xvcGVNYXAucHVzaChzbG9wZUxvb2t1cFtpXSAhPT0gbnVsbCA/IHNsb3BlTG9va3VwW2ldIHx8ICdGVUxMJyA6IHVuZGVmaW5lZCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmdhbWUuZ2FtZS5zbG9wZXMuY29udmVydFRpbGVtYXBMYXllcih0aGlzLmJhY2tncm91bmRMYXllciwgc2xvcGVNYXApO1xyXG4gICAgLy8gdGhpcy5tYXAuc2V0Q29sbGlzaW9uQmV0d2VlbigwLCAyOTEsIHRydWUsICdiYWNrZ3JvdW5kJyk7XHJcbn1cclxuXHJcbk1hcC5wcm90b3R5cGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZXZlbnRzO1xyXG59XHJcblxyXG5NYXAucHJvdG90eXBlLnNldHVwU3Bhd25zID0gZnVuY3Rpb24gKGdhbWUsIG1hcCkge1xyXG4gICAgdmFyIHNwYXducyA9IFtdO1xyXG4gICAgbWFwLm9iamVjdHNbJ1NwYXducyddLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCl7XHJcbiAgICAgICAgc3Bhd25zLnB1c2gobmV3IFNwYXduKGdhbWUsIGVsZW1lbnQpKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHNwYXducztcclxufVxyXG5cclxuTWFwLnByb3RvdHlwZS5zZXR1cEV2ZW50cyA9IGZ1bmN0aW9uIChnYW1lLCBtYXApIHtcclxuICAgIHZhciBldmVudHMgPSBbXTtcclxuICAgIG1hcC5vYmplY3RzWydFdmVudHMnXS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpe1xyXG4gICAgICAgIGV2ZW50cy5wdXNoKG5ldyAoRXZlbnRUeXBlc1tlbGVtZW50LnR5cGVdKShnYW1lLCBlbGVtZW50KSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBldmVudHM7XHJcbn1cclxuXHJcbk1hcC5wcm90b3R5cGUuc2V0dXBMb2NhdGlvbnMgPSBmdW5jdGlvbiAobWFwKSB7XHJcbiAgICB2YXIgbG9jYXRpb25zID0ge307XHJcbiAgICBtYXAub2JqZWN0c1snTG9jYXRpb25zJ10uZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KXtcclxuICAgICAgICBsb2NhdGlvbnNbZWxlbWVudC5uYW1lXSA9IHtcclxuICAgICAgICAgICAgeDogZWxlbWVudC54ICsgZWxlbWVudC53aWR0aCAvIDIsXHJcbiAgICAgICAgICAgIHk6IGVsZW1lbnQueSArIGVsZW1lbnQuaGVpZ2h0IC8gMlxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBsb2NhdGlvbnM7XHJcbn1cclxuXHJcbk1hcC5wcm90b3R5cGUuZ2V0TG9jYXRpb24gPSBmdW5jdGlvbihpZCkge1xyXG4gICAgcmV0dXJuIHRoaXMubG9jYXRpb25zW2lkXTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBNYXA7XHJcbiIsInZhciBucG1Qcm9wZXJ0aWVzID0gcmVxdWlyZSgnLi4vcGFja2FnZS5qc29uJyk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIHRpdGxlOiAnRWFydGhib3VuZC5qcycsXHJcbiAgICBkZXNjcmlwdGlvbjogbnBtUHJvcGVydGllcy5kZXNjcmlwdGlvbixcclxuICAgIHBvcnQ6IDMwMTcsXHJcbiAgICBsaXZlUmVsb2FkUG9ydDogMzAxOCxcclxuICAgIG11dGU6IGZhbHNlLFxyXG4gICAgc2hvd1N0YXRzOiB0cnVlLFxyXG4gICAgc2l6ZToge1xyXG4gICAgICAgIHg6IDI1NixcclxuICAgICAgICB5OiAyMjRcclxuICAgIH0sXHJcbiAgICBhbmFseXRpY3NJZDogJ1VBLTUwNzU5NTEtNydcclxufTtcclxuIiwiLyogZ2xvYmFsIFN0YXRzICovXHJcblxyXG52YXIgcHJvcGVydGllcyA9IHJlcXVpcmUoJy4uL3Byb3BlcnRpZXMnKTtcclxudmFyIGJvb3QgPSB7fTtcclxuXHJcbmJvb3QuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHByb3BlcnRpZXMuc2hvd1N0YXRzKSB7XHJcbiAgICAgICAgYWRkU3RhdHModGhpcy5nYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmdhbWUuc291bmQubXV0ZSA9IHByb3BlcnRpZXMubXV0ZTtcclxuXHJcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ3ByZWxvYWRlcicpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gYWRkU3RhdHMoZ2FtZSkge1xyXG4gICAgdmFyIHN0YXRzID0gbmV3IFN0YXRzKCk7XHJcblxyXG4gICAgc3RhdHMuc2V0TW9kZSgwKTtcclxuXHJcbiAgICBzdGF0cy5kb21FbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUucmlnaHQgPSAnMHB4JztcclxuICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUudG9wID0gJzBweCc7XHJcblxyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzdGF0cy5kb21FbGVtZW50KTtcclxuXHJcbiAgICAvLyBJbiBvcmRlciB0byBjb3JyZWN0bHkgbW9uaXRvciBGUFMsIHdlIGhhdmUgdG8gbWFrZSBjYWxscyB0byB0aGUgc3RhdHMgcGFja2FnZSBiZWZvcmUgYW5kIGFmdGVyIHBoYXNlcidzIHVwZGF0ZS5cclxuICAgIHZhciBvbGRVcGRhdGUgPSBnYW1lLnVwZGF0ZTtcclxuICAgIGdhbWUudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgc3RhdHMuYmVnaW4oKTtcclxuICAgICAgICBvbGRVcGRhdGUuYXBwbHkoZ2FtZSwgYXJndW1lbnRzKTtcclxuICAgICAgICBzdGF0cy5lbmQoKTtcclxuICAgIH07XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gYm9vdDtcclxuIiwiLyogZ2xvYmFsIFBoYXNlciAqL1xyXG5cclxudmFyIENvbmZpZyA9IHJlcXVpcmUoJy4uL3V0aWxzL0NvbmZpZycpXHJcbnZhciBMb2FkZXIgPSByZXF1aXJlKCcuLi91dGlscy9Mb2FkZXInKTtcclxudmFyIFN1YlN0YXRlID0gcmVxdWlyZSgnLi4vdXRpbHMvU3ViU3RhdGUnKTtcclxudmFyIFBsYXllckdyb3VwID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvUGxheWVyR3JvdXAnKTtcclxudmFyIEVuZW15ID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvRW5lbXknKTtcclxudmFyIE1hcCA9IHJlcXVpcmUoJy4uL21hcC9NYXAnKTtcclxudmFyIHN1YnN0YXRlcyA9IHtcclxuICAgIHdvcmxkOiByZXF1aXJlKCcuLi9zdWJzdGF0ZXMvV29ybGQnKSxcclxuICAgIHRyYW5zaXRpb246IHJlcXVpcmUoJy4uL3N1YnN0YXRlcy9UcmFuc2l0aW9uJyksXHJcbiAgICBkaWFsb2c6IHJlcXVpcmUoJy4uL3N1YnN0YXRlcy9EaWFsb2cnKSxcclxuICAgIGJhdHRsZTogcmVxdWlyZSgnLi4vc3Vic3RhdGVzL0JhdHRsZScpLFxyXG4gICAgd29ybGRtZW51OiByZXF1aXJlKCcuLi9zdWJzdGF0ZXMvV29ybGRNZW51JyksXHJcbiAgICB3b3JsZGdvb2RzbWVudTogcmVxdWlyZSgnLi4vc3Vic3RhdGVzL1dvcmxkR29vZHNNZW51JylcclxufTtcclxudmFyIERpYWxvZ0NvbXBvbmVudCA9IHJlcXVpcmUoJy4uL3VpL0RpYWxvZ0NvbXBvbmVudCcpO1xyXG52YXIgdWlUeXBlcyA9IHJlcXVpcmUoJy4uL3VpJyk7XHJcblxyXG52YXIgZ2FtZSA9IHt9O1xyXG5cclxuZ2FtZS5zdWJzdGF0ZSA9IG5ldyBTdWJTdGF0ZShnYW1lLCBzdWJzdGF0ZXMpO1xyXG5cclxuZ2FtZS5pbml0ID0gZnVuY3Rpb24obWFwaWQsIHN0YXJ0TG9jYXRpb24pIHtcclxuICAgIHRoaXMubWFwSWQgPSBtYXBpZDtcclxuICAgIHRoaXMuc3RhcnRMb2NhdGlvbklkID0gc3RhcnRMb2NhdGlvbjtcclxufVxyXG5cclxuZ2FtZS5wcmVsb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgTG9hZGVyLmxvYWRSZXNvdXJjZShnYW1lLmdhbWUsICdkZWZhdWx0Jyk7XHJcbiAgICBMb2FkZXIubG9hZFJlc291cmNlKGdhbWUuZ2FtZSwgdGhpcy5tYXBJZCk7XHJcblxyXG4gICAgZ2FtZS5sb2FkLnNwcml0ZXNoZWV0KCdhY3RvcnMnLCAnaW1hZ2VzL2FjdG9ycy5wbmcnLCAyNCwgMzIpO1xyXG59XHJcblxyXG5nYW1lLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMubWFwQ29uZmlnID0gQ29uZmlnLmdldFJlc291cmNlKHRoaXMubWFwSWQpO1xyXG5cclxuICAgIHRoaXMucGh5c2ljcy5zdGFydFN5c3RlbShQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xyXG4gICAgdGhpcy5nYW1lLnBsdWdpbnMuYWRkKFBoYXNlci5QbHVnaW4uQXJjYWRlU2xvcGVzKTtcclxuICAgIGdhbWUucGh5c2ljcy5hcmNhZGUuZ3Jhdml0eS55ID0gMDtcclxuXHJcbiAgICBpZiAodGhpcy5tYXBDb25maWcuYmdtKSB7XHJcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kTXVzaWMgPSBnYW1lLmFkZC5hdWRpbyh0aGlzLm1hcENvbmZpZy5iZ20pO1xyXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZE11c2ljLnBsYXkoJycsIDAsIDEsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zb3VuZEVmZmVjdHMgPSB7XHJcbiAgICAgICAgc2Z4X2Rvb3Jfb3BlbjogZ2FtZS5hZGQuYXVkaW8oJ3NmeF9kb29yX29wZW4nKVxyXG4gICAgfTtcclxuICAgIHRoaXMuY3VycmVudE1hcCA9IG5ldyBNYXAoZ2FtZSwgdGhpcy5tYXBDb25maWcpO1xyXG4gICAgdGhpcy5lbmVtaWVzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcclxuXHJcbiAgICB0aGlzLnNwYXducyA9IGdhbWUuYWRkLmdyb3VwKCk7XHJcbiAgICB0aGlzLmN1cnJlbnRNYXAuc3Bhd25zLmZvckVhY2goZnVuY3Rpb24gKHNwYXduKSB7XHJcbiAgICAgICAgdGhpcy5zcGF3bnMuYWRkKHNwYXduKTtcclxuICAgIH0sIHRoaXMpO1xyXG5cclxuICAgIHZhciBwbGF5ZXJTdGFydCA9IHRoaXMuY3VycmVudE1hcC5nZXRMb2NhdGlvbih0aGlzLnN0YXJ0TG9jYXRpb25JZCk7XHJcbiAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXJHcm91cChnYW1lLmdhbWUsIHRoaXMuY3VycmVudE1hcCwgcGxheWVyU3RhcnQueCwgcGxheWVyU3RhcnQueSk7XHJcbiAgICB0aGlzLmNoYXREaWFsb2cgPSBuZXcgRGlhbG9nQ29tcG9uZW50KGdhbWUuZ2FtZSk7XHJcbiAgICB0aGlzLnNldHVwVUkoKTtcclxuICAgIHRoaXMuc3dpdGNoU3ViU3RhdGUoJ3dvcmxkJyk7XHJcblxyXG4gICAgdGhpcy5jdXJzb3JzID0gZ2FtZS5pbnB1dC5rZXlib2FyZC5jcmVhdGVDdXJzb3JLZXlzKCk7XHJcbiAgICB0aGlzLmFjdGlvbktleSA9IGdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5TUEFDRUJBUik7XHJcbiAgICB0aGlzLmNhbmNlbEtleSA9IGdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5YKTtcclxuICAgIHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXlDYXB0dXJlKFsgUGhhc2VyLktleWJvYXJkLlNQQUNFQkFSLCBQaGFzZXIuS2V5Ym9hcmQuWCBdKTtcclxuXHJcbiAgICB0aGlzLmZhZGVJbigpO1xyXG59O1xyXG5cclxuZ2FtZS5zZXR1cFVJID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgdWlDb25maWcgPSBDb25maWcuZ2V0Q29uZmlnKCd1aScpO1xyXG4gICAgdmFyIHVpID0ge307XHJcbiAgICBPYmplY3Qua2V5cyh1aUNvbmZpZykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgdmFyIGNvbmZpZyA9IHVpQ29uZmlnW2tleV07XHJcbiAgICAgICAgdWlba2V5XSA9IG5ldyAodWlUeXBlc1tjb25maWcudHlwZV0pKGdhbWUuZ2FtZSwgY29uZmlnKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy51aSA9IHVpO1xyXG59XHJcblxyXG4vKiBTaW1wbGUgRGVidWdcclxuZ2FtZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBnYW1lLmdhbWUuZGVidWcuYm9keSh0aGlzLnBsYXllcik7XHJcbn1cclxuKi9cclxuXHJcbmdhbWUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5zdWJzdGF0ZS51cGRhdGUoKTtcclxufVxyXG5cclxuZ2FtZS5zd2l0Y2hTdWJTdGF0ZSA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgdGhpcy5zdWJzdGF0ZS5zd2l0Y2goaWQpO1xyXG59O1xyXG5cclxuLyogLS0tLS0tLSBBY3Rpb25zIC0tLS0tLS0tLS0gKi9cclxuXHJcbmdhbWUuZmFkZUluID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcbiAgICB0aGlzLnVpLm1hdHRlLnRyYW5zaXRpb24oMHgwMDAwMDAsIDAsIDUwMCwgY2FsbGJhY2spO1xyXG59O1xyXG5cclxuZ2FtZS5mYWRlT3V0ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcbiAgICB0aGlzLnVpLm1hdHRlLnRyYW5zaXRpb24oMHgwMDAwMDAsIDEsIDUwMCwgY2FsbGJhY2spO1xyXG59O1xyXG5cclxuZ2FtZS5lbmNvdW50ZXJJbiA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgdGhpcy51aS5tYXR0ZS50cmFuc2l0aW9uKDB4RkYwMDAwLCAwLjUsIDUwMCwgY2FsbGJhY2spO1xyXG59O1xyXG5cclxuZ2FtZS5lbmNvdW50ZXJPdXQgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgIHRoaXMudWkubWF0dGUudHJhbnNpdGlvbigweEZGMDAwMCwgMCwgMTAsIGNhbGxiYWNrKTtcclxufTtcclxuXHJcbmdhbWUuaGlkZVdvcmxkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5wbGF5ZXIudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5lbmVtaWVzLnZpc2libGUgPSBmYWxzZTtcclxuICAgIHRoaXMuY3VycmVudE1hcC5iYWNrZ3JvdW5kTGF5ZXIudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5jdXJyZW50TWFwLmZvcmVncm91bmRMYXllci52aXNpYmxlID0gZmFsc2U7XHJcbiAgICB0aGlzLnVpLm1hdHRlLm1hdHRlLnZpc2libGUgPSBmYWxzZTtcclxuICAgIC8vIHRoaXMud29ybGQudmlzaWJsZSA9IGZhbHNlO1xyXG59XHJcblxyXG5nYW1lLnNob3dXb3JsZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMucGxheWVyLnZpc2libGUgPSB0cnVlO1xyXG4gICAgdGhpcy5lbmVtaWVzLnZpc2libGUgPSB0cnVlO1xyXG4gICAgdGhpcy5jdXJyZW50TWFwLmJhY2tncm91bmRMYXllci52aXNpYmxlID0gdHJ1ZTtcclxuICAgIHRoaXMuY3VycmVudE1hcC5mb3JlZ3JvdW5kTGF5ZXIudmlzaWJsZSA9IHRydWU7XHJcbiAgICB0aGlzLnVpLm1hdHRlLm1hdHRlLnZpc2libGUgPSB0cnVlO1xyXG4gICAgLy8gdGhpcy53b3JsZC52aXNpYmxlID0gdHJ1ZTtcclxufVxyXG5cclxuZ2FtZS5oaWRlQmF0dGxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy51aS5iYXR0bGViZy5oaWRlKCk7XHJcbn1cclxuXHJcbmdhbWUuc2hvd0JhdHRsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMudWkuYmF0dGxlYmcuc2hvdygpO1xyXG59XHJcblxyXG5nYW1lLnNvdW5kRWZmZWN0UGxheSA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgdGhpcy5zb3VuZEVmZmVjdHNbaWRdLnBsYXkoKTtcclxufTtcclxuXHJcbmdhbWUudHJhbnNwb3J0ID0gZnVuY3Rpb24obWFwSWQsIGxvY2F0aW9uSWQpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHRoaXMuc3dpdGNoU3ViU3RhdGUoJ3RyYW5zaXRpb24nKTtcclxuICAgIHRoaXMuc291bmRFZmZlY3RQbGF5KCdzZnhfZG9vcl9vcGVuJyk7XHJcbiAgICB0aGlzLmZhZGVPdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKHNlbGYubWFwSWQgPT09IG1hcElkKSB7XHJcbiAgICAgICAgICAgIHZhciBsb2NhdGlvblBvcyA9IHNlbGYuY3VycmVudE1hcC5nZXRMb2NhdGlvbihsb2NhdGlvbklkKTtcclxuICAgICAgICAgICAgc2VsZi5wbGF5ZXIucmVzZXQobG9jYXRpb25Qb3MueCwgbG9jYXRpb25Qb3MueSk7XHJcbiAgICAgICAgICAgIHNlbGYuZmFkZUluKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hTdWJTdGF0ZSgnd29ybGQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VsZi5iYWNrZ3JvdW5kTXVzaWMuc3RvcCgpO1xyXG4gICAgICAgICAgICBzZWxmLnN0YXRlLnN0YXJ0KCdnYW1lJywgdHJ1ZSwgZmFsc2UsIG1hcElkLCBsb2NhdGlvbklkKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbmdhbWUuc2hvd0RpYWxvZyA9IGZ1bmN0aW9uIChkaXNwbGF5VGV4dCkge1xyXG4gICAgdGhpcy5jaGF0RGlhbG9nLnNldFRleHQoZGlzcGxheVRleHQpO1xyXG4gICAgdGhpcy5zd2l0Y2hTdWJTdGF0ZSgnZGlhbG9nJyk7XHJcbn1cclxuXHJcbmdhbWUubWFwVGludCA9IGZ1bmN0aW9uICh0aW50KSB7XHJcbiAgICB0aGlzLmN1cnJlbnRNYXAuZm9yZWdyb3VuZExheWVyLnRpbnQgPSB0aW50O1xyXG4gICAgdGhpcy5jdXJyZW50TWFwLmJhY2tncm91bmRMYXllci50aW50ID0gdGludDtcclxufVxyXG5cclxuZ2FtZS5zcGF3bkVuZW15ID0gZnVuY3Rpb24gKHR5cGUsIHgsIHkpIHtcclxuICAgIHRoaXMuZW5lbWllcy5hZGQobmV3IEVuZW15KHRoaXMuZ2FtZSwgdHlwZSwgeCwgeSkpO1xyXG59XHJcblxyXG4vLyBVc2UgLy9mb3JlZ3JvdW5kTGF5ZXIudGludCA9IDB4MjIyMjk5OyB0byBzaW11bGF0ZSBuaWdodHRpbWVcclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGdhbWU7XHJcbiIsInZhciBwcmVsb2FkZXIgPSB7fTtcclxuXHJcbnByZWxvYWRlci5wcmVsb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgLy8gdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2xvZ28nLCAnaW1hZ2VzL3BoYXNlci5wbmcnKTtcclxufTtcclxuXHJcbnByZWxvYWRlci5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ2dhbWUnLCB0cnVlLCBmYWxzZSwgJ21hcF9ob3VzZScsICdzdGFydCcpO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBwcmVsb2FkZXI7XHJcbiIsIlxyXG52YXIgQmF0dGxlU3ViU3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkge1xyXG4gICAgdGhpcy5wYXJlbnQgPSBzdGF0ZTtcclxufVxyXG5cclxuQmF0dGxlU3ViU3RhdGUucHJvdG90eXBlLnRyYW5zaXRpb25JbiA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICB2YXIgc3RhdGUgPSB0aGlzLnBhcmVudDtcclxuICAgIHN0YXRlLmVuY291bnRlckluKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzdGF0ZS5oaWRlV29ybGQoKTtcclxuICAgICAgICBzdGF0ZS5zaG93QmF0dGxlKCk7XHJcbiAgICAgICAgY2FsbGJhY2soKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5CYXR0bGVTdWJTdGF0ZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgc3RhdGUgPSB0aGlzLnBhcmVudDtcclxuICAgIGlmIChzdGF0ZS5hY3Rpb25LZXkuaXNEb3duKSB7XHJcbiAgICAgICAgc3RhdGUuc3dpdGNoU3ViU3RhdGUoJ3dvcmxkJyk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5CYXR0bGVTdWJTdGF0ZS5wcm90b3R5cGUudHJhbnNpdGlvbk91dCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICB2YXIgc3RhdGUgPSB0aGlzLnBhcmVudDtcclxuICAgIHN0YXRlLnNob3dXb3JsZCgpO1xyXG4gICAgc3RhdGUuaGlkZUJhdHRsZSgpO1xyXG4gICAgc3RhdGUuZW5jb3VudGVyT3V0KGNhbGxiYWNrKTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBCYXR0bGVTdWJTdGF0ZTtcclxuIiwiXHJcbnZhciBEaWFsb2dTdWJTdGF0ZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XHJcbiAgICB0aGlzLnBhcmVudCA9IHN0YXRlO1xyXG59XHJcblxyXG5EaWFsb2dTdWJTdGF0ZS5wcm90b3R5cGUuZW50ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMucGFyZW50LmNoYXREaWFsb2cuc2hvdygpO1xyXG59O1xyXG5cclxuRGlhbG9nU3ViU3RhdGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHN0YXRlID0gdGhpcy5wYXJlbnQ7XHJcblxyXG4gICAgaWYgKHN0YXRlLmFjdGlvbktleS5pc0Rvd24pIHtcclxuICAgICAgICBzdGF0ZS5zd2l0Y2hTdWJTdGF0ZSgnd29ybGQnKTtcclxuICAgIH1cclxufTtcclxuXHJcbkRpYWxvZ1N1YlN0YXRlLnByb3RvdHlwZS5leGl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLnBhcmVudC5jaGF0RGlhbG9nLmhpZGUoKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRGlhbG9nU3ViU3RhdGU7XHJcbiIsInZhciBNZW51U3ViU3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkge1xyXG4gICAgdGhpcy5wYXJlbnQgPSBzdGF0ZTtcclxufVxyXG5cclxuTWVudVN1YlN0YXRlLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHN0YXRlID0gdGhpcy5wYXJlbnQ7XHJcbiAgICB0aGlzLm1lbnUgPSBzdGF0ZS51aVt0aGlzLm1lbnVJZF07XHJcbiAgICB0aGlzLm1lbnUuc2V0T3B0aW9ucyh0aGlzLmdldE9wdGlvbnMoKSk7XHJcbiAgICB0aGlzLm1lbnUuc2hvdygpO1xyXG4gICAgdGhpcy5zZXRDb29sT2ZmKCk7XHJcbn07XHJcblxyXG5NZW51U3ViU3RhdGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHN0YXRlID0gdGhpcy5wYXJlbnQ7XHJcblxyXG4gICAgaWYgKHRoaXMuY29vbE9mZiA8PSAwKSB7XHJcbiAgICAgICAgaWYgKHN0YXRlLmNhbmNlbEtleS5pc0Rvd24pIHtcclxuICAgICAgICAgICAgdGhpcy5vbkNhbmNlbCAmJiB0aGlzLm9uQ2FuY2VsKCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5hY3Rpb25LZXkuaXNEb3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMub25TZWxlY3QgJiYgdGhpcy5vblNlbGVjdCh0aGlzLm1lbnUuZ2V0U2VsZWN0ZWRJZCgpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmN1cnNvcnMudXAuaXNEb3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVudS5zZWxlY3Rpb25VcCgpXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q29vbE9mZigpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhdGUuY3Vyc29ycy5kb3duLmlzRG93bikge1xyXG4gICAgICAgICAgICB0aGlzLm1lbnUuc2VsZWN0aW9uRG93bigpXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q29vbE9mZigpO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5jb29sT2ZmLS07XHJcbiAgICB9XHJcbn07XHJcblxyXG5NZW51U3ViU3RhdGUucHJvdG90eXBlLnNldENvb2xPZmYgPSBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMuY29vbE9mZiA9IDEwO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBNZW51U3ViU3RhdGU7XHJcbiIsIlxyXG52YXIgVHJhbnNpdGlvblN1YlN0YXRlID0gZnVuY3Rpb24oc3RhdGUpIHtcclxuICAgIHRoaXMucGFyZW50ID0gc3RhdGU7XHJcbn07XHJcblxyXG5UcmFuc2l0aW9uU3ViU3RhdGUucHJvdG90eXBlLmVudGVyID0gZnVuY3Rpb24oKSB7XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFRyYW5zaXRpb25TdWJTdGF0ZTtcclxuIiwiLyogZ2xvYmFsIFBoYXNlciAqL1xyXG5cclxudmFyIFdvcmxkU3ViU3RhdGUgPSBmdW5jdGlvbihwYXJlbnQpIHtcclxuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xyXG59XHJcblxyXG5Xb3JsZFN1YlN0YXRlLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHN0YXRlID0gdGhpcy5wYXJlbnQ7XHJcbiAgICBzdGF0ZS5wbGF5ZXJEaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgc3RhdGUuZ2FtZS5jYW1lcmEuZm9sbG93KHN0YXRlLnBsYXllci5nZXRMZWFkZXIoKSwgUGhhc2VyLkNhbWVyYS5GT0xMT1dfVE9QRE9XTik7XHJcbiAgICB0aGlzLmFjdGlvbkNvb2xPZmYgPSAyMDtcclxufTtcclxuXHJcbldvcmxkU3ViU3RhdGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHN0YXRlID0gdGhpcy5wYXJlbnQ7XHJcblxyXG4gICAgaWYgKHRoaXMuYWN0aW9uQ29vbE9mZiA+IDApIHtcclxuICAgICAgICB0aGlzLmFjdGlvbkNvb2xPZmYtLTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHN0YXRlLmNhbmNlbEtleS5pc0Rvd24pIHtcclxuICAgICAgICAgICAgc3RhdGUuc3dpdGNoU3ViU3RhdGUoJ3dvcmxkbWVudScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0ZS5lbmVtaWVzLnNvcnQoJ3knLCBQaGFzZXIuR3JvdXAuU09SVF9BU0NFTkRJTkcpO1xyXG4gICAgc3RhdGUucGxheWVyLnNvcnQoJ3knLCBQaGFzZXIuR3JvdXAuU09SVF9BU0NFTkRJTkcpO1xyXG5cclxuICAgIHN0YXRlLnBoeXNpY3MuYXJjYWRlLmNvbGxpZGUoc3RhdGUuZW5lbWllcywgc3RhdGUuY3VycmVudE1hcC5iYWNrZ3JvdW5kTGF5ZXIpO1xyXG5cclxuICAgIGlmICghc3RhdGUucGxheWVyRGlzYWJsZWQpIHtcclxuICAgICAgICB2YXIgZXZlbnRzID0gc3RhdGUuY3VycmVudE1hcC5nZXRFdmVudHMoKTtcclxuXHJcbiAgICAgICAgc3RhdGUucGh5c2ljcy5hcmNhZGUuY29sbGlkZShzdGF0ZS5wbGF5ZXIsIHN0YXRlLmN1cnJlbnRNYXAuYmFja2dyb3VuZExheWVyKTtcclxuICAgICAgICBzdGF0ZS5waHlzaWNzLmFyY2FkZS5jb2xsaWRlKHN0YXRlLnBsYXllciwgc3RhdGUuZW5lbWllcywgZnVuY3Rpb24ocGxheWVyLCBlbmVteSkge1xyXG4gICAgICAgICAgICBlbmVteS5vblRvdWNoKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc3RhdGUucGh5c2ljcy5hcmNhZGUuY29sbGlkZShzdGF0ZS5wbGF5ZXIuZ2V0TGVhZGVyKCksIGV2ZW50cywgZnVuY3Rpb24ocGxheWVyLCBldmVudCkge1xyXG4gICAgICAgICAgICBldmVudC5vblRvdWNoKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5Xb3JsZFN1YlN0YXRlLnByb3RvdHlwZS5leGl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLnBhcmVudC5wbGF5ZXJEaXNhYmxlZCA9IHRydWU7XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gV29ybGRTdWJTdGF0ZTtcclxuIiwidmFyIE1lbnVTdWJTdGF0ZSA9IHJlcXVpcmUoJy4vTWVudScpO1xyXG5cclxudmFyIFdvcmxkR29vZHNNZW51U3ViU3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkge1xyXG4gICAgTWVudVN1YlN0YXRlLmNhbGwodGhpcywgc3RhdGUpO1xyXG59XHJcblxyXG5Xb3JsZEdvb2RzTWVudVN1YlN0YXRlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoTWVudVN1YlN0YXRlLnByb3RvdHlwZSk7XHJcbldvcmxkR29vZHNNZW51U3ViU3RhdGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gV29ybGRHb29kc01lbnVTdWJTdGF0ZTtcclxuXHJcbldvcmxkR29vZHNNZW51U3ViU3RhdGUucHJvdG90eXBlLm1lbnVJZCA9ICd3b3JsZGdvb2RzbWVudSc7XHJcblxyXG5Xb3JsZEdvb2RzTWVudVN1YlN0YXRlLnByb3RvdHlwZS5nZXRPcHRpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICAgIHtpZDogJ3NuZWFrZXInLCB0ZXh0OiAnT2xkIFNuZWFrZXInfSxcclxuICAgICAgICB7aWQ6ICdzdHVuZ3VuJywgdGV4dDogJ1N0dW4gR3VuJ30sXHJcbiAgICAgICAge2lkOiAnc29jaycsIHRleHQ6ICdTb2NrJ31cclxuICAgIF07XHJcbn07XHJcblxyXG5Xb3JsZEdvb2RzTWVudVN1YlN0YXRlLnByb3RvdHlwZS5vbkNhbmNlbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5tZW51LmhpZGUoKTtcclxuICAgIHRoaXMucGFyZW50LnN3aXRjaFN1YlN0YXRlKCd3b3JsZG1lbnUnKTtcclxufTtcclxuXHJcbldvcmxkR29vZHNNZW51U3ViU3RhdGUucHJvdG90eXBlLm9uU2VsZWN0ID0gZnVuY3Rpb24oaWQpIHtcclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFdvcmxkR29vZHNNZW51U3ViU3RhdGU7XHJcbiIsInZhciBNZW51U3ViU3RhdGUgPSByZXF1aXJlKCcuL01lbnUnKTtcclxuXHJcbnZhciBXb3JsZE1lbnVTdWJTdGF0ZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XHJcbiAgICBNZW51U3ViU3RhdGUuY2FsbCh0aGlzLCBzdGF0ZSk7XHJcbn1cclxuXHJcbldvcmxkTWVudVN1YlN0YXRlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoTWVudVN1YlN0YXRlLnByb3RvdHlwZSk7XHJcbldvcmxkTWVudVN1YlN0YXRlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFdvcmxkTWVudVN1YlN0YXRlO1xyXG5cclxuV29ybGRNZW51U3ViU3RhdGUucHJvdG90eXBlLm1lbnVJZCA9ICd3b3JsZG1lbnUnO1xyXG5cclxuV29ybGRNZW51U3ViU3RhdGUucHJvdG90eXBlLmdldE9wdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBbXHJcbiAgICAgICAge2lkOiAnZ29vZHMnLCB0ZXh0OiAnR29vZHMnfSxcclxuICAgICAgICB7aWQ6ICdlcXVpcCcsIHRleHQ6ICdFcXVpcCd9LFxyXG4gICAgICAgIHtpZDogJ3N0YXR1cycsIHRleHQ6ICdTdGF0dXMnfVxyXG4gICAgXTtcclxufTtcclxuXHJcbldvcmxkTWVudVN1YlN0YXRlLnByb3RvdHlwZS5vbkNhbmNlbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5tZW51LmhpZGUoKTtcclxuICAgIHRoaXMucGFyZW50LnN3aXRjaFN1YlN0YXRlKCd3b3JsZCcpO1xyXG59O1xyXG5cclxuV29ybGRNZW51U3ViU3RhdGUucHJvdG90eXBlLm9uU2VsZWN0ID0gZnVuY3Rpb24oaWQpIHtcclxuICAgIHN3aXRjaCAoaWQpIHtcclxuICAgICAgICBjYXNlICdnb29kcyc6IHRoaXMucGFyZW50LnN3aXRjaFN1YlN0YXRlKCd3b3JsZGdvb2RzbWVudScpOyBicmVhaztcclxuICAgIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gV29ybGRNZW51U3ViU3RhdGU7XHJcbiIsIi8qIGdsb2JhbCBQaGFzZXIgKi9cclxuXHJcbmZ1bmN0aW9uIEJhdHRsZUJhY2tncm91bmRMaW5lKGdhbWUsIHksIHdpZHRoLCBoZWlnaHQsIHNraW4pIHtcclxuICAgIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCAwLCB5LCBza2luKTtcclxuICAgIHRoaXMubGluZVdpZHRoID0gd2lkdGg7XHJcbiAgICB0aGlzLmxpbmVIZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICB0aGlzLnQgPSAwO1xyXG59XHJcblxyXG5CYXR0bGVCYWNrZ3JvdW5kTGluZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcclxuQmF0dGxlQmFja2dyb3VuZExpbmUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQmF0dGxlQmFja2dyb3VuZExpbmU7XHJcblxyXG5CYXR0bGVCYWNrZ3JvdW5kTGluZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHQgPSB0aGlzLnQrKztcclxuICAgIHZhciB5ID0gdGhpcy55O1xyXG4gICAgdmFyIHdpZHRoID0gdGhpcy5saW5lV2lkdGg7XHJcbiAgICB2YXIgaGVpZ2h0ID0gdGhpcy5saW5lSGVpZ2h0O1xyXG5cclxuICAgIHZhciBBID0gMzA7XHJcbiAgICB2YXIgRiA9IDAuMDM7XHJcbiAgICB2YXIgUyA9IDAuMDQ7XHJcblxyXG4gICAgdmFyIG9mZnNldCA9IEEgKiBNYXRoLnNpbihGICogeSArIFMgKiB0KTtcclxuICAgIHRoaXMuY3JvcChuZXcgUGhhc2VyLlJlY3RhbmdsZShNYXRoLmZsb29yKChvZmZzZXQgKyB3aWR0aCkgJSB3aWR0aCksIHkgJSA2NCwgd2lkdGgsIGhlaWdodCkpO1xyXG4gICAgdGhpcy51cGRhdGVDcm9wKCk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBCYXR0bGVCYWNrZ3JvdW5kKGdhbWUsIGNvbmZpZykge1xyXG4gICAgdmFyIHdpZHRoID0gZ2FtZS53aWR0aDtcclxuICAgIHZhciBoZWlnaHQgPSBnYW1lLmhlaWdodDtcclxuICAgIHZhciBiYWNrZ3JvdW5kID0gZ2FtZS5hZGQuZ3JvdXAoKTtcclxuICAgIHZhciBzaXplID0gMjtcclxuXHJcbiAgICBiYWNrZ3JvdW5kLmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xyXG4gICAgZm9yICh2YXIgeSA9IDA7IHkgPCBoZWlnaHQ7IHkgKz0gMikge1xyXG4gICAgICAgIGJhY2tncm91bmQuYWRkKG5ldyBCYXR0bGVCYWNrZ3JvdW5kTGluZShnYW1lLCB5LCB3aWR0aCwgc2l6ZSwgJ2JhdHRsZWJnXzEnKSk7XHJcbiAgICB9XHJcblxyXG4gICAgYmFja2dyb3VuZC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICB0aGlzLmJhY2tncm91bmQgPSBiYWNrZ3JvdW5kO1xyXG59O1xyXG5cclxuQmF0dGxlQmFja2dyb3VuZC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5iYWNrZ3JvdW5kLnZpc2libGUgPSB0cnVlO1xyXG59O1xyXG5cclxuQmF0dGxlQmFja2dyb3VuZC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5iYWNrZ3JvdW5kLnZpc2libGUgPSBmYWxzZTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQmF0dGxlQmFja2dyb3VuZDtcclxuIiwiLyogZ2xvYmFsIFBoYXNlciAqL1xyXG5cclxuZnVuY3Rpb24gRGlhbG9nQ29tcG9uZW50IChnYW1lKSB7XHJcbiAgICBnYW1lLmNhY2hlLmFkZE5pbmVQYXRjaCgnbmluZXBhdGNoX2RpYWxvZycsICdpbWFnZV9kaWFsb2cnLCBudWxsLCA4LCA4LCAxNiwgMTYpO1xyXG4gICAgdGhpcy5jb250YWluZXIgPSBuZXcgUGhhc2VyLk5pbmVQYXRjaEltYWdlKGdhbWUsIDk2LCA4LCAnbmluZXBhdGNoX2RpYWxvZycpO1xyXG4gICAgdGhpcy5jb250YWluZXIudGFyZ2V0V2lkdGggPSAxNTI7XHJcbiAgICB0aGlzLmNvbnRhaW5lci50YXJnZXRIZWlnaHQgPSA2NFxyXG4gICAgdGhpcy5jb250YWluZXIuZml4ZWRUb0NhbWVyYSA9IHRydWU7XHJcbiAgICB0aGlzLmNoYXRUeHQgPSBbXTtcclxuICAgIHRoaXMubGluZUNvdW50ID0gMztcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5lQ291bnQ7IGkrKykge1xyXG4gICAgICAgIHZhciBjaGF0TGluZSA9IGdhbWUubWFrZS5iaXRtYXBUZXh0KDgsIDggKyAoaSAqIDE2KSwgJ2ZvbnRfYmFzaWMnLCAnJywgMTYsIHRoaXMuY29udGFpbmVyKTtcclxuICAgICAgICBjaGF0TGluZS5tYXhXaWR0aCA9IDEyODtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGRDaGlsZChjaGF0TGluZSk7XHJcbiAgICAgICAgdGhpcy5jaGF0VHh0LnB1c2goY2hhdExpbmUpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jb250YWluZXIudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5jbGVhcigpO1xyXG4gICAgZ2FtZS50aW1lLmV2ZW50cy5sb29wKDI1LCB0aGlzLnVwZGF0ZSwgdGhpcyk7XHJcbn07XHJcblxyXG5EaWFsb2dDb21wb25lbnQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKHRoaXMuYnVmZmVyLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBJZiB3ZSBoYXZlIG1vcmUgdGV4dCB0byBzaG93LCBhbmQgd2UgaGF2ZSByZWFjaGVkIGxpbmVDb3VudFxyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRMaW5lID49IHRoaXMubGluZUNvdW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudExpbmUtLTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAodGhpcy5saW5lQ291bnQgLSAxKTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXRUeHRbaV0uc2V0VGV4dCh0aGlzLmNoYXRUeHRbaSsxXS50ZXh0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNoYXRUeHRbdGhpcy5jdXJyZW50TGluZV0uc2V0VGV4dCgnJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5idWZmZXJbMF0ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YXIgYyA9IHRoaXMuYnVmZmVyWzBdLnN1YnN0cigwLCAxKTtcclxuICAgICAgICAgICAgdGhpcy5idWZmZXJbMF0gPSB0aGlzLmJ1ZmZlclswXS5zdWJzdHIoMSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhdFR4dFt0aGlzLmN1cnJlbnRMaW5lXS5zZXRUZXh0KHRoaXMuY2hhdFR4dFt0aGlzLmN1cnJlbnRMaW5lXS50ZXh0ICsgYyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5idWZmZXIuc2hpZnQoKTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50TGluZSsrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbkRpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUuc2V0VGV4dCA9IGZ1bmN0aW9uKHRleHQpIHtcclxuICAgIHZhciBsaW5lO1xyXG4gICAgZG8ge1xyXG4gICAgICAgIC8vIFByaXZhdGUgbWV0aG9kIEkgd2lzaCB3YXMgUHVibGljXHJcbiAgICAgICAgbGluZSA9IHRoaXMuY2hhdFR4dFswXS5zY2FuTGluZSh0aGlzLmNoYXRUeHRbMF0uX2RhdGEuZm9udCwgMSwgdGV4dCk7XHJcbiAgICAgICAgdGhpcy5idWZmZXIucHVzaChsaW5lLnRleHQpO1xyXG4gICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cihsaW5lLnRleHQubGVuZ3RoICsgMSk7XHJcbiAgICB9IHdoaWxlIChsaW5lLmVuZCA9PT0gZmFsc2UpO1xyXG59O1xyXG5cclxuRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLmNvbnRhaW5lci52aXNpYmxlID0gdHJ1ZTtcclxufTtcclxuXHJcbkRpYWxvZ0NvbXBvbmVudC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5jb250YWluZXIudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5jbGVhcigpO1xyXG59O1xyXG5cclxuRGlhbG9nQ29tcG9uZW50LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5idWZmZXIgPSBbXTtcclxuICAgIHRoaXMuY3VycmVudExpbmUgPSAwO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpbmVDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgdGhpcy5jaGF0VHh0W2ldLnNldFRleHQoJycpO1xyXG4gICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBEaWFsb2dDb21wb25lbnQ7XHJcbiIsIi8qIGdsb2JhbCBQaGFzZXIgKi9cclxuXHJcbmZ1bmN0aW9uIEZyYW1lKGdhbWUsIGNvbmZpZykge1xyXG4gICAgZ2FtZS5jYWNoZS5hZGROaW5lUGF0Y2goJ25pbmVwYXRjaF9kaWFsb2cnLCAnaW1hZ2VfZGlhbG9nJywgbnVsbCwgOCwgOCwgMTYsIDE2KTtcclxuICAgIHZhciBmcmFtZSA9IG5ldyBQaGFzZXIuTmluZVBhdGNoSW1hZ2UoZ2FtZSwgY29uZmlnLngsIGNvbmZpZy55LCAnbmluZXBhdGNoX2RpYWxvZycpO1xyXG4gICAgZnJhbWUudGFyZ2V0V2lkdGggPSBjb25maWcud2lkdGg7XHJcbiAgICBmcmFtZS50YXJnZXRIZWlnaHQgPSBjb25maWcuaGVpZ2h0O1xyXG4gICAgZnJhbWUuZml4ZWRUb0NhbWVyYSA9IHRydWU7XHJcbiAgICBmcmFtZS52aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5mcmFtZSA9IGZyYW1lO1xyXG59O1xyXG5cclxuRnJhbWUucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMuZnJhbWUudmlzaWJsZSA9IHRydWU7XHJcbn07XHJcblxyXG5GcmFtZS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5mcmFtZS52aXNpYmxlID0gZmFsc2U7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEZyYW1lO1xyXG4iLCJmdW5jdGlvbiBNYXR0ZUNvbXBvbmVudCAoZ2FtZSkge1xyXG4gICAgdmFyIG1hdHRlID0gZ2FtZS5hZGQuZ3JhcGhpY3MoMCwgMCk7XHJcbiAgICBtYXR0ZS5maXhlZFRvQ2FtZXJhID0gdHJ1ZTtcclxuICAgIG1hdHRlLmFscGhhID0gMTtcclxuXHJcbiAgICB0aGlzLm1hdHRlID0gbWF0dGU7XHJcbiAgICB0aGlzLmdhbWUgPSBnYW1lO1xyXG59O1xyXG5cclxuTWF0dGVDb21wb25lbnQucHJvdG90eXBlLnRyYW5zaXRpb24gPSBmdW5jdGlvbiAoY29sb3IsIGFscGhhLCB0aW1lLCBjYWxsYmFjaykge1xyXG4gICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9O1xyXG5cclxuICAgIHZhciBnYW1lID0gdGhpcy5nYW1lO1xyXG4gICAgdmFyIG1hdHRlID0gdGhpcy5tYXR0ZTtcclxuICAgIG1hdHRlLmNsZWFyKCk7XHJcbiAgICBtYXR0ZS5iZWdpbkZpbGwoY29sb3IsIDEpO1xyXG4gICAgbWF0dGUuZHJhd1JlY3QoMCwgMCwgZ2FtZS53aWR0aCwgZ2FtZS5oZWlnaHQpO1xyXG4gICAgbWF0dGUuZW5kRmlsbCgpO1xyXG5cclxuICAgIHZhciBzID0gdGhpcy5nYW1lLmFkZC50d2Vlbih0aGlzLm1hdHRlKTtcclxuICAgIHMudG8oeyBhbHBoYTogYWxwaGEgfSwgdGltZSwgbnVsbCk7XHJcbiAgICBzLm9uQ29tcGxldGUuYWRkKGNhbGxiYWNrKTtcclxuICAgIHMuc3RhcnQoKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTWF0dGVDb21wb25lbnQ7XHJcbiIsIi8qIGdsb2JhbCBQaGFzZXIgKi9cclxuXHJcbmZ1bmN0aW9uIE1lbnVDb21wb25lbnQgKGdhbWUsIG9wdGlvbnMpIHtcclxuICAgIGdhbWUuY2FjaGUuYWRkTmluZVBhdGNoKCduaW5lcGF0Y2hfZGlhbG9nJywgJ2ltYWdlX2RpYWxvZycsIG51bGwsIDgsIDgsIDE2LCAxNik7XHJcbiAgICB0aGlzLmNvbnRhaW5lciA9IG5ldyBQaGFzZXIuTmluZVBhdGNoSW1hZ2UoZ2FtZSwgb3B0aW9ucy54LCBvcHRpb25zLnksICduaW5lcGF0Y2hfZGlhbG9nJyk7XHJcbiAgICB0aGlzLmNvbnRhaW5lci50YXJnZXRXaWR0aCA9IG9wdGlvbnMud2lkdGg7XHJcbiAgICB0aGlzLmNvbnRhaW5lci50YXJnZXRIZWlnaHQgPSBvcHRpb25zLmhlaWdodFxyXG4gICAgdGhpcy5jb250YWluZXIuZml4ZWRUb0NhbWVyYSA9IHRydWU7XHJcblxyXG4gICAgdGhpcy5tZW51SXRlbXMgPSBbXTtcclxuICAgIHRoaXMubWVudUl0ZW1Db3VudCA9IG9wdGlvbnMucm93cztcclxuICAgIHRoaXMub3B0aW9ucyA9IFtdO1xyXG4gICAgdGhpcy5zZWxlY3Rpb24gPSAwO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1lbnVJdGVtQ291bnQ7IGkrKykge1xyXG4gICAgICAgIHZhciBtZW51SXRlbSA9IGdhbWUubWFrZS5iaXRtYXBUZXh0KDgsIDggKyAoaSAqIDE2KSwgJ2ZvbnRfYmFzaWMnLCAnJywgMTYsIHRoaXMuY29udGFpbmVyKTtcclxuICAgICAgICBtZW51SXRlbS5tYXhXaWR0aCA9IG9wdGlvbnMud2lkdGggLSAyNDtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGRDaGlsZChtZW51SXRlbSk7XHJcbiAgICAgICAgdGhpcy5tZW51SXRlbXMucHVzaChtZW51SXRlbSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNvbnRhaW5lci52aXNpYmxlID0gZmFsc2U7XHJcbiAgICB0aGlzLnNldE9wdGlvbnMoKTtcclxufTtcclxuXHJcbk1lbnVDb21wb25lbnQucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IFtdO1xyXG4gICAgdGhpcy5zZWxlY3Rpb24gPSAwO1xyXG4gICAgdGhpcy5yZXNldCgpO1xyXG59O1xyXG5cclxuTWVudUNvbXBvbmVudC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1lbnVJdGVtQ291bnQ7IGkrKykge1xyXG4gICAgICAgIHZhciBvcHRpb24gPSBvcHRpb25zW2ldO1xyXG4gICAgICAgIHRoaXMubWVudUl0ZW1zW2ldLnNldFRleHQoKHRoaXMuc2VsZWN0aW9uID09PSBpID8gJ0AgJyA6ICcnKSArICgob3B0aW9uICYmIG9wdGlvbi50ZXh0KSB8fCAnJykpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuTWVudUNvbXBvbmVudC5wcm90b3R5cGUuc2VsZWN0aW9uVXAgPSBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMuc2VsZWN0aW9uLS07XHJcbiAgICBpZiAodGhpcy5zZWxlY3Rpb24gPCAwKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24gPSAwO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZXNldCgpO1xyXG59O1xyXG5cclxuTWVudUNvbXBvbmVudC5wcm90b3R5cGUuc2VsZWN0aW9uRG93biA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5zZWxlY3Rpb24rKztcclxuICAgIGlmICh0aGlzLnNlbGVjdGlvbiA+PSB0aGlzLm1lbnVJdGVtQ291bnQpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbiA9IHRoaXMubWVudUl0ZW1Db3VudCAtIDE7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlc2V0KCk7XHJcbn07XHJcblxyXG5NZW51Q29tcG9uZW50LnByb3RvdHlwZS5nZXRTZWxlY3RlZElkID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zICYmXHJcbiAgICAgICAgdGhpcy5vcHRpb25zW3RoaXMuc2VsZWN0aW9uXSAmJlxyXG4gICAgICAgIHRoaXMub3B0aW9uc1t0aGlzLnNlbGVjdGlvbl0uaWQ7XHJcbn07XHJcblxyXG5NZW51Q29tcG9uZW50LnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLmNvbnRhaW5lci52aXNpYmxlID0gdHJ1ZTtcclxufTtcclxuXHJcbk1lbnVDb21wb25lbnQucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMuY29udGFpbmVyLnZpc2libGUgPSBmYWxzZTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTWVudUNvbXBvbmVudDtcclxuIiwibW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgICBtZW51OiByZXF1aXJlKCcuL01lbnUnKSxcclxuICAgIG1hdHRlOiByZXF1aXJlKCcuL01hdHRlJyksXHJcbiAgICBmcmFtZTogcmVxdWlyZSgnLi9GcmFtZScpLFxyXG4gICAgYmF0dGxlYmc6IHJlcXVpcmUoJy4vQmF0dGxlQmFja2dyb3VuZCcpXHJcbn07XHJcbiIsIlxyXG52YXIgQ29uZmlnID0ge307XHJcblxyXG5Db25maWcubG9hZCA9IGZ1bmN0aW9uIChjb25maWcpIHtcclxuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xyXG59O1xyXG5cclxuQ29uZmlnLmdldFJlc291cmNlID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICB2YXIgZGF0YSA9IHRoaXMuY29uZmlnLnJlc291cmNlc1tpZF07XHJcbiAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICB0aHJvdyAnSW52YWxpZCBSZXNvdWNlIElEIC0gJyArIGlkO1xyXG4gICAgfVxyXG4gICAgZGF0YS5pZCA9IGlkO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbn07XHJcblxyXG5Db25maWcuZ2V0Q29uZmlnID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgcmV0dXJuIHRoaXMuY29uZmlnW2tleV07XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQ29uZmlnO1xyXG4iLCIvKiBnbG9iYWwgUGhhc2VyICovXHJcblxyXG52YXIgQ29uZmlnID0gcmVxdWlyZSgnLi9Db25maWcnKTtcclxuXHJcbnZhciBMb2FkZXIgPSB7fTtcclxuXHJcbkxvYWRlci5sb2FkUmVzb3VyY2UgPSBmdW5jdGlvbiAoZ2FtZSwgaWQpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBkZXAgPSBDb25maWcuZ2V0UmVzb3VyY2UoaWQpO1xyXG5cclxuICAgIHN3aXRjaCAoZGVwLnR5cGUpIHtcclxuICAgICAgICBjYXNlICdpbWFnZSc6XHJcbiAgICAgICAgICAgIGlmIChnYW1lLmNhY2hlLmNoZWNrSW1hZ2VLZXkoZGVwLmlkKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdhbWUubG9hZC5pbWFnZShkZXAuaWQsIGRlcC5wYXRoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ3Nwcml0ZSc6XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlICdtYXAnOlxyXG4gICAgICAgICAgICBpZiAoZ2FtZS5jYWNoZS5jaGVja1RpbGVtYXBLZXkoZGVwLmlkKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdhbWUubG9hZC50aWxlbWFwKGRlcC5pZCwgZGVwLnBhdGgsIG51bGwsIFBoYXNlci5UaWxlbWFwLlRJTEVEX0pTT04pO1xyXG4gICAgICAgICAgICBpZiAoZGVwLnRpbGVzZXQpIHtcclxuICAgICAgICAgICAgICAgIGRlcC50aWxlc2V0LmZvckVhY2goZnVuY3Rpb24odGlsZXNldElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2FkUmVzb3VyY2UoZ2FtZSwgdGlsZXNldElkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkZXAuYmdtKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmxvYWRSZXNvdXJjZShnYW1lLCBkZXAuYmdtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAncmVzb3VyY2VzJzpcclxuICAgICAgICAgICAgaWYgKGRlcC5yZXNvdXJjZXMpIHtcclxuICAgICAgICAgICAgICAgIGRlcC5yZXNvdXJjZXMuZm9yRWFjaChmdW5jdGlvbihySWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvYWRSZXNvdXJjZShnYW1lLCBySWQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2F1ZGlvJzpcclxuICAgICAgICAgICAgaWYgKGdhbWUuY2FjaGUuY2hlY2tTb3VuZEtleShkZXAuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZ2FtZS5sb2FkLmF1ZGlvKGRlcC5pZCwgZGVwLnBhdGgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAnYml0bWFwZm9udCc6XHJcbiAgICAgICAgICAgIGlmIChnYW1lLmNhY2hlLmNoZWNrQml0bWFwRm9udEtleShkZXAuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZ2FtZS5sb2FkLmJpdG1hcEZvbnQoZGVwLmlkLCBkZXAucGF0aCwgZGVwLm1ldGEpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTG9hZGVyO1xyXG4iLCJ2YXIgbm9vcCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICByZXR1cm4gY2FsbGJhY2soKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIFN1YlN0YXRlKHN0YXRlLCBzdWJzdGF0ZXMpIHtcclxuICAgIHRoaXMucGFyZW50U3RhdGUgPSBzdGF0ZTtcclxuICAgIHRoaXMuc3Vic3RhdGVzID0gc3Vic3RhdGVzO1xyXG4gICAgdGhpcy5jdXJyZW50U3RhdGUgPSBudWxsO1xyXG59XHJcblxyXG5TdWJTdGF0ZS5wcm90b3R5cGUuc3dpdGNoID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgdHJhbnNpdGlvbk91dCA9IHNlbGYuY3VycmVudFN0YXRlICYmIHNlbGYuY3VycmVudFN0YXRlLnRyYW5zaXRpb25PdXQgP1xyXG4gICAgICAgIHNlbGYuY3VycmVudFN0YXRlLnRyYW5zaXRpb25PdXQuYmluZChzZWxmLmN1cnJlbnRTdGF0ZSkgOiBub29wO1xyXG5cclxuICAgIHRyYW5zaXRpb25PdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKHNlbGYuY3VycmVudFN0YXRlICYmIHNlbGYuY3VycmVudFN0YXRlLmV4aXQpIHtcclxuICAgICAgICAgICAgc2VsZi5jdXJyZW50U3RhdGUuZXhpdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxmLmN1cnJlbnRTdGF0ZSA9IG51bGw7XHJcbiAgICAgICAgdmFyIFN1YlN0YXRlID0gc2VsZi5zdWJzdGF0ZXNbaWRdO1xyXG4gICAgICAgIHZhciBuZXdTdGF0ZSA9IG5ldyBTdWJTdGF0ZShzZWxmLnBhcmVudFN0YXRlKTtcclxuICAgICAgICB2YXIgdHJhbnNpdGlvbkluID0gbmV3U3RhdGUgJiYgbmV3U3RhdGUudHJhbnNpdGlvbkluID9cclxuICAgICAgICAgICAgbmV3U3RhdGUudHJhbnNpdGlvbkluLmJpbmQobmV3U3RhdGUpIDogbm9vcDtcclxuXHJcbiAgICAgICAgdHJhbnNpdGlvbkluKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBzZWxmLmN1cnJlbnRTdGF0ZSA9IG5ld1N0YXRlO1xyXG4gICAgICAgICAgICBpZiAoc2VsZi5jdXJyZW50U3RhdGUgJiYgc2VsZi5jdXJyZW50U3RhdGUuZW50ZXIpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudFN0YXRlLmVudGVyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuU3ViU3RhdGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICh0aGlzLmN1cnJlbnRTdGF0ZSAmJiB0aGlzLmN1cnJlbnRTdGF0ZS51cGRhdGUpIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRTdGF0ZS51cGRhdGUoKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gU3ViU3RhdGU7XHJcbiIsIm1vZHVsZS5leHBvcnRzPXtcclxuICBcIm5hbWVcIjogXCJlYXJ0aGJvdW5kLWpzXCIsXHJcbiAgXCJ2ZXJzaW9uXCI6IFwiMC4wLjFcIixcclxuICBcImRlc2NyaXB0aW9uXCI6IFwiQW4gRWFydGhib3VuZCBEZW1vIGluIEphdmFzY2lwdFwiLFxyXG4gIFwibWFpblwiOiBcImJ1aWxkL2pzL2FwcC5taW4uanNcIixcclxuICBcInNjcmlwdHNcIjoge1xyXG4gICAgXCJsaW50XCI6IFwiZXNsaW50IC0tcXVpZXQgLS1jYWNoZSAuIC0tZXh0IC5qc1wiLFxyXG4gICAgXCJ0ZXN0XCI6IFwiZWNobyBcXFwiRXJyb3I6IG5vIHRlc3Qgc3BlY2lmaWVkXFxcIiAmJiBleGl0IDFcIlxyXG4gIH0sXHJcbiAgXCJhdXRob3JcIjogXCJDYXJ5IFN0YW5sZXlcIixcclxuICBcImJyb3dzZXJcIjoge1xyXG4gICAgXCJTdGF0c1wiOiBcIi4vanMvbGliL3N0YXRzLm1pbi5qc1wiLFxyXG4gICAgXCJzbG9wZXNcIjogXCIuL2pzL2xpYi9waGFzZXItYXJjYWRlLXNsb3Blcy5taW4uanNcIixcclxuICAgIFwibmluZXBhdGNoXCI6IFwiLi9qcy9saWIvbmluZS1wYXRjaC1waGFzZXItcGx1Z2luLm1pbi5qc1wiXHJcbiAgfSxcclxuICBcImRldkRlcGVuZGVuY2llc1wiOiB7XHJcbiAgICBcImJyb3dzZXJpZnlcIjogXCJeMTMuMC4wXCIsXHJcbiAgICBcImJyb3dzZXJpZnktc2hpbVwiOiBcIl4zLjguMTJcIixcclxuICAgIFwiZXNsaW50XCI6IFwiXjMuMC4wXCIsXHJcbiAgICBcImdydW50XCI6IFwiXjAuNC41XCIsXHJcbiAgICBcImdydW50LWJyb3dzZXJpZnlcIjogXCJeNS4wLjBcIixcclxuICAgIFwiZ3J1bnQtY2FjaGUtYnVzdFwiOiBcIl4xLjEuMVwiLFxyXG4gICAgXCJncnVudC1jb250cmliLWNsZWFuXCI6IFwiXjEuMC4wXCIsXHJcbiAgICBcImdydW50LWNvbnRyaWItY29tcHJlc3NcIjogXCJeMS4xLjFcIixcclxuICAgIFwiZ3J1bnQtY29udHJpYi1jb25uZWN0XCI6IFwiXjEuMC4wXCIsXHJcbiAgICBcImdydW50LWNvbnRyaWItY29weVwiOiBcIl4xLjAuMFwiLFxyXG4gICAgXCJncnVudC1jb250cmliLWphZGVcIjogXCJeMS4wLjBcIixcclxuICAgIFwiZ3J1bnQtY29udHJpYi1qc2hpbnRcIjogXCJeMS4wLjBcIixcclxuICAgIFwiZ3J1bnQtY29udHJpYi1zdHlsdXNcIjogXCJeMS4yLjBcIixcclxuICAgIFwiZ3J1bnQtY29udHJpYi11Z2xpZnlcIjogXCJeMS4wLjBcIixcclxuICAgIFwiZ3J1bnQtY29udHJpYi13YXRjaFwiOiBcIl4xLjAuMFwiLFxyXG4gICAgXCJncnVudC1vcGVuXCI6IFwiXjAuMi4zXCIsXHJcbiAgICBcInBoYXNlclwiOiBcIjIuNC44XCIsXHJcbiAgICBcInByZS1jb21taXRcIjogXCJeMS4xLjBcIlxyXG4gIH0sXHJcbiAgXCJlc2xpbnRDb25maWdcIjoge1xyXG4gICAgXCJlczZcIjogdHJ1ZVxyXG4gIH0sXHJcbiAgXCJwcmUtY29tbWl0XCI6IFtcclxuICAgIFwibGludFwiXHJcbiAgXVxyXG59XHJcbiJdfQ==
