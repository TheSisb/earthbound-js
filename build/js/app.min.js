/*
 * Earthbound.js
 * An Earthbound Demo in Javascipt
 *
 * @author Cary Stanley
 * @version 0.0.1
 * @copyright Cary Stanley
 * @license  licensed
 *
 * Made using Phaser JS Boilerplate <https://github.com/lukewilde/phaser-js-boilerplate>
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./properties"),e={boot:a("./states/boot.js"),preloader:a("./states/preloader.js"),game:a("./states/game.js")},f=new Phaser.Game(d.size.x,d.size.y,Phaser.AUTO,"game",null,!1,!1);Object.keys(e).forEach(function(a){var b=e[a];f.state.add(a,b)}),f.state.start("boot")},{"./properties":12,"./states/boot.js":13,"./states/game.js":14,"./states/preloader.js":15}],2:[function(a,b,c){DialogComponent=function(a){this.container=a.add.image(96,8,"chat_dialog"),this.container.fixedToCamera=!0,this.chatTxt=a.make.bitmapText(8,8,"basic","",16,this.container),this.chatTxt.maxWidth=144,this.container.addChild(this.chatTxt),this.container.visible=!1,this.buffer="",this.displayText="",a.time.events.loop(25,this.update,this)},DialogComponent.prototype.update=function(){this.buffer.length>0&&(this.displayText+=this.buffer.substr(0,1),this.buffer=this.buffer.substr(1),this.chatTxt.setText(this.displayText))},DialogComponent.prototype.setText=function(a){this.buffer=a},DialogComponent.prototype.show=function(){this.container.visible=!0},DialogComponent.prototype.hide=function(){this.container.visible=!1,this.clear()},DialogComponent.prototype.clear=function(){this.buffer="",this.displayText="",this.chatTxt.setText(this.displayText)},b.exports=DialogComponent},{}],3:[function(a,b,c){MatteComponent=function(a){var b=a.add.graphics(0,0);b.fixedToCamera=!0,b.beginFill(0,1),b.drawRect(0,0,a.width,a.height),b.alpha=1,b.endFill(),this.matte=b,this.game=a},MatteComponent.prototype.fadeTween=function(a,b){b=b||function(){},s=this.game.add.tween(this.matte),s.to({alpha:a},500,null),s.onComplete.add(b),s.start()},MatteComponent.prototype.fadeIn=function(a){this.fadeTween(0,a)},MatteComponent.prototype.fadeOut=function(a){this.fadeTween(1,a)},b.exports=MatteComponent},{}],4:[function(a,b,c){function d(a,b,c,d,e){var f=8*d;Phaser.Sprite.call(this,a,b,c,"actors"),this.animations.add("up",[f+0,f+1],5,!0),this.animations.add("right",[f+2,f+3],10,!0),this.animations.add("down",[f+4,f+5],5,!0),this.animations.add("left",[f+6,f+7],10,!0),e&&(a.physics.ninja.enableAABB(this),this.body.aabb=new Phaser.Physics.Ninja.AABB(this.body,this.x,this.y,16,7),this.body.shape=this.body.aabb),this.anchor.x=.5,this.anchor.y=1}d.prototype=Object.create(Phaser.Sprite.prototype),d.prototype.constructor=d,b.exports=d},{}],5:[function(a,b,c){function d(a,b,c){Character.call(this,a,c.x,c.y,b,!1),this.initQueue(c,16)}Character=a("./Character"),d.prototype=Object.create(Character.prototype),d.prototype.constructor=d,d.prototype.initQueue=function(a,b){this.followCharacter=a,this.followQueue=[],this.leaderCursor=0,this.followerCursor=1,this.followMax=b;for(var c=0;b>c;c++)this.followQueue[c]={animation:"down",x:a.x,y:a.y}},d.prototype.updateQueue=function(){this.leaderCursor=(this.leaderCursor+1)%this.followMax,this.followerCursor=(this.followerCursor+1)%this.followMax,this.followQueue[this.leaderCursor].animation=this.followCharacter.animations.currentAnim.name,this.followQueue[this.leaderCursor].x=this.followCharacter.x,this.followQueue[this.leaderCursor].y=this.followCharacter.y;var a=this.followQueue[this.followerCursor];this.x=a.x,this.y=a.y,this.play(a.animation)},d.prototype.update=function(){this.game.state.getCurrentState().playerDisabled||(this.followCharacter.animations.currentAnim.isPlaying?this.updateQueue():this.animations.stop())},b.exports=d},{"./Character":4}],6:[function(a,b,c){function d(a,b,c,d,e){Character.call(this,a,c,d,e,!0),this.map=b,this.body.drag=.8,this.body.maxSpeed=60,this.accel=15}Character=a("./Character"),d.prototype=Object.create(Character.prototype),d.prototype.constructor=d,d.prototype.update=function(){if(!this.game.state.getCurrentState().playerDisabled){var a=null,b=this.game.state.getCurrentState().cursors;b.left.isDown?(this.body.moveLeft(this.accel),a="left"):b.right.isDown&&(this.body.moveRight(this.accel),a="right"),b.up.isDown?(this.body.moveUp(this.accel),a="up"):b.down.isDown&&(this.body.moveDown(this.accel),a="down"),a?this.play(a):this.animations.stop()}},b.exports=d},{"./Character":4}],7:[function(a,b,c){function d(a,b){e.call(this,a,b)}var e=a("./Event");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.onTouch=function(){var a=this.settings.properties;this.game.showDialog(a.text)},b.exports=d},{"./Event":8}],8:[function(a,b,c){function d(a,b){this.game=a,this.settings=b,Phaser.Sprite.call(this,a,b.x||0,b.y||0),this.renderable=!1,this.width=b.width||16,this.height=b.height||16,a.physics.ninja.enableAABB(this),this.body.immovable=!0}d.prototype=Object.create(Phaser.Sprite.prototype),d.prototype.constructor=d,d.prototype.onTouch=function(){},b.exports=d},{}],9:[function(a,b,c){function d(a,b){e.call(this,a,b)}var e=a("./Event");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.onTouch=function(){var a=this.settings.properties;this.game.transport(a.map,a.location)},b.exports=d},{"./Event":8}],10:[function(a,b,c){function d(a,b){this.game=a,this.config=b,this.map=a.add.tilemap(b.id),Object.keys(b.tilesets).forEach(function(a){this.map.addTilesetImage(a,a)},this),a.world.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.backgroundLayer=this.map.createLayer("background"),this.foregroundLayer=this.map.createLayer("foreground"),this.locations=this.setupLocations(this.map),this.events=this.setupEvents(this.game,this.map);for(var c={291:0,158:4,159:5,97:0,80:4,81:5,82:5},d=[],e=0;291>e;e++)d.push(void 0!==c[e]?c[e]:1);this.collisonTiles=a.physics.ninja.convertTilemap(this.map,this.backgroundLayer,d)}var e={transport:a("../events/TransportEvent"),dialog:a("../events/DialogEvent")};d.prototype.getCollisionMap=function(){return this.collisonTiles},d.prototype.getEvents=function(){return this.events},d.prototype.setupEvents=function(a,b){return events=[],b.objects.Events.forEach(function(b){events.push(new e[b.type](a,b))}),events},d.prototype.setupLocations=function(a){var b={};return a.objects.Locations.forEach(function(a){b[a.name]={x:a.x+a.width/2,y:a.y+a.height/2}}),b},d.prototype.getLocation=function(a){return this.locations[a]},d.prototype.getConfig=function(){return this.config},b.exports=d},{"../events/DialogEvent":7,"../events/TransportEvent":9}],11:[function(a,b,c){b.exports={house:{id:"house",tilemap:"maps/house.json",tilesets:{house_tileset:"images/house_tileset.png"}}}},{}],12:[function(a,b,c){var d=a("../../package.json");b.exports={title:"Earthbound.js",description:d.description,port:3017,liveReloadPort:3018,mute:!1,showStats:!0,size:{x:256,y:224},analyticsId:"UA-5075951-7"}},{"../../package.json":20}],13:[function(a,b,c){function d(a){var b=new e;b.setMode(0),b.domElement.style.position="absolute",b.domElement.style.right="0px",b.domElement.style.top="0px",document.body.appendChild(b.domElement);var c=a.update;a.update=function(){b.begin(),c.apply(a,arguments),b.end()}}var e=a("Stats"),f=a("../properties"),g={};g.create=function(){f.showStats&&d(this.game),this.game.sound.mute=f.mute,this.game.state.start("preloader")},b.exports=g},{"../properties":12,Stats:19}],14:[function(a,b,c){var d=a("../entities/Follower"),e=a("../entities/Player"),f=a("../map/MapConfig"),g=a("../map/Map"),h={World:a("../substates/World"),Transition:a("../substates/Transition"),Dialog:a("../substates/Dialog")},i=a("../components/DialogComponent"),j=a("../components/MatteComponent"),k={};k.SubState=h,k.init=function(a,b){this.mapConfig=f[a],this.startLocationId=b},k.preload=function(){var a=this.mapConfig;k.load.tilemap(a.id,a.tilemap,null,Phaser.Tilemap.TILED_JSON),Object.keys(a.tilesets).forEach(function(b){k.load.image(b,a.tilesets[b])}),k.load.image("chat_dialog","images/chat_dialog.png"),k.load.bitmapFont("basic","fonts/basic.png","fonts/basic.xml"),k.load.bitmapFont("mrsaturn","fonts/mrsaturn.png","fonts/mrsaturn.xml"),k.load.audio("background_boymeetsgirl",["audio/background_boymeetsgirl.mp3"]),k.load.audio("effect_door_open",["audio/effect_door_open.wav"]),k.load.spritesheet("actors","images/actors.png",24,32)};var l,m;k.create=function(){k.physics.startSystem(Phaser.Physics.NINJA),k.physics.ninja.gravity=0,this.backgroundMusic=k.add.audio("background_boymeetsgirl"),this.soundEffects={effect_door_open:k.add.audio("effect_door_open")},this.backgroundMusic.play("",0,1,!0),this.currentMap=new g(k,this.mapConfig),this.characters=k.add.group();var a=this.currentMap.getLocation(this.startLocationId);this.player=new e(k.game,this.currentMap,a.x,a.y,0),l=new d(k.game,1,this.player),m=new d(k.game,2,l),this.characters.add(this.player),this.characters.add(l),this.characters.add(m),this.matte=new j(k.game),this.chatDialog=new i(k.game),this.switchSubState(h.World),this.cursors=k.input.keyboard.createCursorKeys(),this.spaceKey=k.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]),this.matte.fadeIn()},k.update=function(){this.substate&&this.substate.update&&this.substate.update.call(this)},k.switchSubState=function(a){this.substate&&this.substate.exit&&this.substate.exit.call(this),this.substate=a,this.substate&&this.substate.enter&&this.substate.enter.call(this)},k.fadeIn=function(a){this.matte.fadeIn(a)},k.fadeOut=function(a){this.matte.fadeOut(a)},k.soundEffectPlay=function(a){this.soundEffects[a].play()},k.transport=function(a,b){var c=this;this.switchSubState(h.Transition),this.soundEffectPlay("effect_door_open"),this.fadeOut(function(){if(c.mapConfig.id===a){var d=c.currentMap.getLocation(b);c.player.reset(d.x,d.y),c.fadeIn(function(){c.switchSubState(h.World)})}else c.backgroundMusic.stop(),c.state.start("game",!0,!1,a,b)})},k.showDialog=function(a){this.chatDialog.setText(a),this.switchSubState(h.Dialog)},b.exports=k},{"../components/DialogComponent":2,"../components/MatteComponent":3,"../entities/Follower":5,"../entities/Player":6,"../map/Map":10,"../map/MapConfig":11,"../substates/Dialog":16,"../substates/Transition":17,"../substates/World":18}],15:[function(a,b,c){var d={};d.preload=function(){},d.create=function(){this.game.state.start("game",!0,!1,"house","start")},b.exports=d},{}],16:[function(a,b,c){var d={enter:function(){this.playerDisabled=!0,this.chatDialog.show()},update:function(){this.spaceKey.isDown&&this.switchSubState(this.SubState.World)},exit:function(){this.chatDialog.hide()}};b.exports=d},{}],17:[function(a,b,c){var d={enter:function(){this.playerDisabled=!0},update:function(){},exit:function(){}};b.exports=d},{}],18:[function(a,b,c){var d={enter:function(){this.playerDisabled=!1,this.game.camera.follow(this.player,Phaser.Camera.FOLLOW_TOPDOWN)},update:function(){if(this.characters.sort("y",Phaser.Group.SORT_ASCENDING),!this.playerDisabled){for(var a=this.currentMap.getCollisionMap(),b=this.currentMap.getEvents(),c=0;c<a.length;c++)this.player.body.aabb.collideAABBVsTile(a[c].tile);this.physics.ninja.overlap(this.player,b,function(a,b){b.onTouch()})}},exit:function(){}};b.exports=d},{}],19:[function(a,b,c){(function(a){(function(a,b,c,d,e){var f=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}};e("undefined"!=typeof f?f:window.Stats)}).call(a,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(a,b,c){b.exports={name:"earthbound-js",version:"0.0.1",description:"An Earthbound Demo in Javascipt",main:"build/js/app.min.js",scripts:{test:'echo "Error: no test specified" && exit 1'},author:"Cary Stanley",browser:{Stats:"./js/lib/stats.min.js"},"browserify-shim":{Stats:{exports:"Stats"}},dependencies:{browserify:"^13.0.0","browserify-shim":"^3.8.12",grunt:"^0.4.5","grunt-browserify":"^5.0.0","grunt-cache-bust":"^1.1.1","grunt-contrib-clean":"^1.0.0","grunt-contrib-compress":"^1.1.1","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-jade":"^1.0.0","grunt-contrib-jshint":"^1.0.0","grunt-contrib-stylus":"^1.2.0","grunt-contrib-uglify":"^1.0.0","grunt-contrib-watch":"^1.0.0","grunt-open":"^0.2.3",phaser:"^2.4.6"}}},{}]},{},[1]);